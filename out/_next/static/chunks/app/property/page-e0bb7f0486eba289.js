(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[82],{6330:function(e,t,a){Promise.resolve().then(a.bind(a,4800))},4800:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return O}});var r=a(7437),s=a(2265),n=a(6484),o=a(9116),i=a(2869),l=a(5186),c=a(6815),d=a(6070),u=a(5974),m=a(3247),f=a(9397),h=a(3774),p=a(1047),x=a(7648),g=a(8730),y=a(9376),v=a(4156),j=a(401),b=a(4508),N=a(6343);a(6110);let w=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(N.mY,{ref:t,className:(0,b.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",a),...s})});w.displayName=N.mY.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,r.jsx)(m.Z,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,r.jsx)(N.mY.Input,{ref:t,className:(0,b.cn)("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",a),...s})]})}).displayName=N.mY.Input.displayName;let C=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(N.mY.List,{ref:t,className:(0,b.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",a),...s})});C.displayName=N.mY.List.displayName;let k=s.forwardRef((e,t)=>(0,r.jsx)(N.mY.Empty,{ref:t,className:"py-6 text-center text-sm",...e}));k.displayName=N.mY.Empty.displayName;let S=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(N.mY.Group,{ref:t,className:(0,b.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",a),...s})});S.displayName=N.mY.Group.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(N.mY.Separator,{ref:t,className:(0,b.cn)("-mx-1 h-px bg-border",a),...s})}).displayName=N.mY.Separator.displayName;let _=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(N.mY.Item,{ref:t,className:(0,b.cn)("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a),...s})});_.displayName=N.mY.Item.displayName;var P=a(7312);let R=P.fC,Z=P.xz,A=s.forwardRef((e,t)=>{let{className:a,align:s="center",sideOffset:n=4,...o}=e;return(0,r.jsx)(P.h_,{children:(0,r.jsx)(P.VY,{ref:t,align:s,sideOffset:n,className:(0,b.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...o})})});function z(e){let{options:t,value:a,onValueChange:n,onSearchChange:o,onInputChange:c,placeholder:d="Выберите...",searchPlaceholder:f="Поиск...",emptyMessage:p="Ничего не найдено.",loading:x=!1,disabled:g=!1,className:y,renderOption:N}=e,[P,z]=s.useState(!1),[E,Y]=s.useState(""),L=t.find(e=>e.value===a);s.useEffect(()=>{P&&Y("")},[P]);let I=e=>{console.log("LocationAutocomplete: Search changed to:",e),Y(e),null==o||o(e)},U=e=>{let a=t.find(t=>t.value===e);a&&(n(a.value),Y(a.label)),z(!1)};return console.log("LocationAutocomplete render:",{options:t.length,value:a,searchValue:E,open:P}),(0,r.jsxs)(R,{open:P,onOpenChange:z,children:[(0,r.jsx)(Z,{asChild:!0,children:(0,r.jsxs)(i.z,{variant:"outline",role:"combobox","aria-expanded":P,className:(0,b.cn)("w-full justify-between",y),disabled:g,onClick:()=>z(!0),children:[L?(0,r.jsxs)("div",{className:"flex items-center gap-2 truncate",children:[(0,r.jsx)(h.Z,{className:"h-4 w-4 shrink-0"}),(0,r.jsx)("span",{className:"truncate",children:L.label}),L.country&&(0,r.jsx)(u.C,{variant:"secondary",className:"shrink-0 text-xs",children:L.country})]}):(0,r.jsx)("span",{className:"text-muted-foreground",children:d}),(0,r.jsx)(v.Z,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,r.jsxs)(A,{className:"w-full p-0",align:"start",children:[(0,r.jsx)("div",{className:"p-2 border-b",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(m.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,r.jsx)(l.I,{placeholder:f,value:E,onChange:e=>{I(e.target.value),null==c||c(e.target.value)},className:"pl-8",autoFocus:!0})]})}),(0,r.jsx)(w,{children:(0,r.jsxs)(C,{children:[(0,r.jsx)(k,{children:x?"Загрузка...":p}),(0,r.jsx)(S,{children:t.map(e=>(0,r.jsxs)(_,{value:e.value,onSelect:U,children:[(0,r.jsx)(j.Z,{className:(0,b.cn)("mr-2 h-4 w-4",a===e.value?"opacity-100":"opacity-0")}),N?N(e):(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"font-medium",children:e.label}),e.description&&(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:e.description})]})]},e.value))})]})})]})]})}A.displayName=P.VY.displayName;var E=a(8502),Y=a(1723),L=a(6595);function I(e){let{type:t,value:a,onValueChange:n,cityValue:i,placeholder:l,label:d,className:u,showRemembered:m=!0}=e,[f,p]=(0,s.useState)([]),[x,g]=(0,s.useState)(!1),[y,v]=(0,s.useState)(""),[j,b]=(0,s.useState)([]),N=function(e,t){let[a,r]=(0,s.useState)(e);return(0,s.useEffect)(()=>{let t=setTimeout(()=>{r(e)},300);return()=>{clearTimeout(t)}},[e,300]),a}(y,0);(0,s.useEffect)(()=>{m&&w()},[i,m]);let w=(0,s.useCallback)(async()=>{try{let e=[];"city"===t?e=(await o.PH.getPopularAddresses(10)).addresses||[]:i&&(e=(await o.PH.getRememberedAddresses(i,10)).addresses||[]),b(e)}catch(e){console.error("Error loading remembered addresses:",e)}},[t,i,m]),C=(0,s.useCallback)(async e=>{if(console.log("EnhancedLocationSearch: Searching for:",e,"type:",t),!e.trim()||e.length<2){console.log("EnhancedLocationSearch: Query too short, showing remembered addresses"),m&&await w();return}g(!0);try{let a;let r=[];if("city"===t){if(console.log("EnhancedLocationSearch: Calling searchCities"),a=await E.t.searchCities(e,10),m)try{r=(await o.PH.searchAddresses(e,5)).addresses||[]}catch(e){console.error("Error searching remembered addresses:",e)}}else if(console.log("EnhancedLocationSearch: Calling searchStreets"),a=await E.t.searchStreets(e,i,10),m&&i)try{r=(await o.PH.getRememberedAddresses(i,5)).addresses||[]}catch(e){console.error("Error searching remembered addresses:",e)}if(console.log("EnhancedLocationSearch: Got result:",a),a.error){console.error("Geocoding error:",a.error),p([]);return}let s=a.suggestions.map(e=>{let a=e.address,r=e.display_name,s="",n=a.country;if("city"===t){let e=a.city||a.town||a.village;if(e){r=e;let t=[];a.state&&t.push(a.state),a.country&&t.push(a.country),s=t.join(", ")}}else{let e=a.street||a.road;if(e){r=e;let t=[];(a.city||a.town)&&t.push(a.city||a.town),a.state&&t.push(a.state),a.country&&t.push(a.country),s=t.join(", ")}}return{value:r,label:r,description:s,country:n,source:"geocoding"}}),n=r.map(e=>{let a="",r="";return"city"===t?(a=e.city,r="".concat(e.street,", ").concat(e.building)):(a=e.street,r="".concat(e.building)),e.residentialComplex&&(r+=" (".concat(e.residentialComplex,")")),{value:a,label:a,description:r,source:"remembered",usageCount:e.usageCount}}),l=[...s,...n].filter((e,t,a)=>t===a.findIndex(t=>t.value===e.value));l.sort((e,t)=>"remembered"===e.source&&"remembered"!==t.source?-1:"remembered"!==e.source&&"remembered"===t.source?1:e.usageCount&&t.usageCount?t.usageCount-e.usageCount:0),p(l)}catch(e){console.error("Error searching locations:",e),p([])}finally{g(!1)}},[t,i,m,w]);(0,s.useEffect)(()=>{C(N)},[N,C]);let k=j.map(e=>{let a="",r="";return"city"===t?(a=e.city,r="".concat(e.street,", ").concat(e.building)):(a=e.street,r="".concat(e.building)),e.residentialComplex&&(r+=" (".concat(e.residentialComplex,")")),{value:a,label:a,description:r,source:"remembered",usageCount:e.usageCount}}),S=y.trim()?f:k;return(0,r.jsxs)("div",{className:u,children:[d&&(0,r.jsx)(c._,{className:"mb-2 block",children:d}),(0,r.jsx)(z,{value:a||"",onValueChange:e=>{n(e),v(e)},onInputChange:e=>{v(e),!e.trim()&&(p([]),m&&w())},options:S,loading:x,placeholder:l||("city"===t?"Поиск города...":"Поиск улицы..."),renderOption:e=>(0,r.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:["remembered"===e.source?(0,r.jsx)(Y.Z,{className:"h-4 w-4 text-blue-500"}):(0,r.jsx)(h.Z,{className:"h-4 w-4 text-gray-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium",children:e.label}),e.description&&(0,r.jsx)("div",{className:"text-sm text-gray-500",children:e.description})]})]}),"remembered"===e.source&&e.usageCount&&(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)(L.Z,{className:"h-3 w-3 text-yellow-500 fill-current"}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:e.usageCount})]})]})})]})}function U(e){let{ratings:t,showLabels:a=!0,compact:s=!1}=e;if(!t)return null;let n={apartment:"Квартира",residentialComplex:"Жилой комплекс",courtyard:"Двор",parking:"Парковка",infrastructure:"Инфраструктура"},o=e=>Array.from({length:5},(t,a)=>(0,r.jsx)(L.Z,{className:"".concat(s?"h-3 w-3":"h-4 w-4"," ").concat(a<e?"text-yellow-500 fill-current":"text-gray-300")},a)),i=Object.entries(t).filter(e=>{let[t,a]=e;return null!=a});return 0===i.length?null:(0,r.jsx)("div",{className:"space-y-".concat(s?"1":"2"),children:i.map(e=>{let[t,i]=e;return(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[a&&(0,r.jsxs)("span",{className:"text-sm text-gray-600 min-w-[100px] ".concat(s?"text-xs":""),children:[n[t],":"]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[o(i),(0,r.jsxs)("span",{className:"text-sm font-medium ".concat(s?"text-xs":""),children:[i,"/5"]})]})]},t)})})}function V(e){let{rating:t}=e;return t?(0,r.jsxs)(u.C,{variant:"outline",className:t>=4.5?"bg-green-100 text-green-800 border-green-200":t>=3.5?"bg-blue-100 text-blue-800 border-blue-200":t>=2.5?"bg-yellow-100 text-yellow-800 border-yellow-200":"bg-red-100 text-red-800 border-red-200",children:[(0,r.jsx)(L.Z,{className:"h-3 w-3 mr-1 fill-current"}),t,"/5"]}):null}function O(){var e;let{user:t,loading:a}=(0,g.a)(),v=(0,y.useRouter)();if(!a&&!t)return v.push("/login"),null;if(a)return(0,r.jsx)("div",{className:"text-center py-16",children:"Загрузка..."});let[j,b]=(0,s.useState)({city:"",street:"",building:"",rooms:""}),{data:N,isLoading:w,refetch:C}=(0,n.useQuery)(["property-reviews",j],async()=>{let e=new URLSearchParams;return Object.entries(j).forEach(t=>{let[a,r]=t;r&&e.append(a,r)}),(await o.hi.get("/property/reviews?".concat(e))).data}),k=e=>{b(t=>({...t,[e.target.name]:e.target.value}))};return(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Отзывы о недвижимости"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Ищите отзывы о квартирах, зданиях и районах"})]}),(0,r.jsxs)(d.Zb,{children:[(0,r.jsx)(d.Ol,{children:(0,r.jsxs)(d.ll,{className:"flex items-center",children:[(0,r.jsx)(m.Z,{className:"h-5 w-5 mr-2"}),"Поиск недвижимости"]})}),(0,r.jsx)(d.aY,{children:(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),C()},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,r.jsx)("div",{className:"space-y-2",children:(0,r.jsx)(I,{type:"city",value:j.city,onValueChange:e=>b(t=>({...t,city:e})),label:"Город",placeholder:"Поиск города..."})}),(0,r.jsx)("div",{className:"space-y-2",children:(0,r.jsx)(I,{type:"street",value:j.street,onValueChange:e=>b(t=>({...t,street:e})),cityValue:j.city,label:"Улица",placeholder:"Поиск улицы..."})}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(c._,{htmlFor:"building",children:"Здание"}),(0,r.jsx)(l.I,{id:"building",name:"building",value:j.building,onChange:k,placeholder:"Номер здания"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(c._,{htmlFor:"rooms",children:"Комнаты"}),(0,r.jsx)(l.I,{id:"rooms",name:"rooms",type:"number",min:"1",max:"8",value:j.rooms,onChange:k,placeholder:"Количество комнат"})]})]}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsxs)(i.z,{type:"submit",disabled:w,children:[(0,r.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Поиск"]}),(0,r.jsx)(i.z,{variant:"outline",asChild:!0,children:(0,r.jsxs)(x.default,{href:"/property/add",children:[(0,r.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),"Добавить отзыв"]})})]})]})})]}),w?(0,r.jsx)("div",{className:"text-center py-8",children:"Загрузка..."}):(0,r.jsx)("div",{className:"space-y-6",children:(null==N?void 0:null===(e=N.reviews)||void 0===e?void 0:e.length)>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["Найдено ",N.pagination.total," отзывов"]}),(0,r.jsx)("div",{className:"grid gap-6",children:N.reviews.map(e=>(console.log(e),(0,r.jsxs)(d.Zb,{children:[(0,r.jsx)(d.Ol,{children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(d.ll,{className:"flex items-center",children:[(0,r.jsx)(h.Z,{className:"h-5 w-5 mr-2 text-blue-600"}),e.street," ",e.building,", ",e.city]}),(0,r.jsxs)(d.SZ,{className:"flex items-center mt-2",children:[(0,r.jsxs)(u.C,{variant:"secondary",className:"mr-2",children:[e.numberOfRooms," комнат"]}),e.rating&&(0,r.jsx)(V,{rating:e.rating})]})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["от ",e.author.firstName," ",e.author.lastName]})]})}),(0,r.jsxs)(d.aY,{children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,r.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Период аренды: ",e.rentalPeriod.from.month,"/",e.rentalPeriod.from.year," -"," ",e.rentalPeriod.to.month,"/",e.rentalPeriod.to.year]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:["Арендодатель: ",e.landlordName]}),(0,r.jsx)("p",{className:"text-gray-700 mb-4",children:e.reviewText}),e.ratings&&(0,r.jsxs)("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-zinc-800 rounded-lg",children:[(0,r.jsx)("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Детальные оценки:"}),(0,r.jsx)(U,{ratings:e.ratings,compact:!0})]})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["Опубликовано"," ",new Date(e.createdAt).toLocaleDateString()]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("h4",{className:"font-semibold mb-2",children:"Комментарии"}),e.comments&&e.comments.filter(e=>e.isApproved).length>0?(0,r.jsx)("div",{className:"space-y-2",children:e.comments.length>0&&e.comments.filter(e=>e.isApproved).map(t=>(0,r.jsxs)("div",{className:"border rounded p-2 bg-gray-50 dark:bg-zinc-800 flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:[t.author.firstName," ",t.author.lastName," •"," ",new Date(t.createdAt).toLocaleString()]}),(0,r.jsx)("button",{className:"text-xs text-red-500 hover:underline ml-2",onClick:async()=>{await o.hi.post("/property/reviews/".concat(e._id,"/comments/").concat(t._id,"/report")),alert("Комментарий отправлен на модерацию")},title:"Пожаловаться на комментарий",children:"Пожаловаться"})]}),(0,r.jsx)("div",{className:"text-sm text-gray-800 dark:text-gray-100 mt-1",children:t.text})]},t._id))}):(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Комментариев пока нет."}),(0,r.jsx)(T,{reviewId:e._id})]})]})]},e._id)))})]}):(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:"Отзывы не найдены"}),(0,r.jsx)(i.z,{asChild:!0,children:(0,r.jsxs)(x.default,{href:"/property/add",children:[(0,r.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),"Будьте первым, кто добавит отзыв"]})})]})})]})}function T(e){let{reviewId:t}=e,[a,n]=(0,s.useState)(""),[l,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),m=async e=>{e.preventDefault(),c(!0),u(!1);try{await o.hi.post("/property/reviews/".concat(t,"/comments"),{text:a}),n(""),u(!0)}catch(e){alert("Ошибка при добавлении комментария")}finally{c(!1)}};return(0,r.jsxs)("form",{onSubmit:m,className:"mt-3 flex flex-col gap-2",children:[(0,r.jsx)("textarea",{className:"border rounded p-2 text-sm",rows:2,value:a,onChange:e=>n(e.target.value),placeholder:"Напишите комментарий...",required:!0,maxLength:1e3}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(i.z,{type:"submit",size:"sm",disabled:l||!a.trim(),children:l?"Отправка...":"Добавить комментарий"}),d&&(0,r.jsx)("span",{className:"text-green-600 text-xs",children:"Комментарий отправлен на модерацию"})]})]})}},5974:function(e,t,a){"use strict";a.d(t,{C:function(){return i}});var r=a(7437);a(2265);var s=a(535),n=a(4508);let o=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...s}=e;return(0,r.jsx)("div",{className:(0,n.cn)(o({variant:a}),t),...s})}},2869:function(e,t,a){"use strict";a.d(t,{z:function(){return c}});var r=a(7437),s=a(2265),n=a(7053),o=a(535),i=a(4508);let l=(0,o.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:a,variant:s,size:o,asChild:c=!1,...d}=e,u=c?n.g7:"button";return(0,r.jsx)(u,{className:(0,i.cn)(l({variant:s,size:o,className:a})),ref:t,...d})});c.displayName="Button"},6070:function(e,t,a){"use strict";a.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return o},aY:function(){return d},ll:function(){return l}});var r=a(7437),s=a(2265),n=a(4508);let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});o.displayName="Card";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...s})});i.displayName="CardHeader";let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});l.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...s})});d.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter"},6110:function(e,t,a){"use strict";a.d(t,{$N:function(){return h},Be:function(){return p},Vq:function(){return l},cZ:function(){return m},fK:function(){return f},hg:function(){return c}});var r=a(7437),s=a(2265),n=a(9027),o=a(2489),i=a(4508);let l=n.fC,c=n.xz,d=n.h_;n.x8;let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.aV,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});u.displayName=n.aV.displayName;let m=s.forwardRef((e,t)=>{let{className:a,children:s,...l}=e;return(0,r.jsxs)(d,{children:[(0,r.jsx)(u,{}),(0,r.jsxs)(n.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...l,children:[s,(0,r.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=n.VY.displayName;let f=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};f.displayName="DialogHeader";let h=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})});h.displayName=n.Dx.displayName;let p=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...s})});p.displayName=n.dk.displayName},5186:function(e,t,a){"use strict";a.d(t,{I:function(){return o}});var r=a(7437),s=a(2265),n=a(4508);let o=s.forwardRef((e,t)=>{let{className:a,type:s,error:o,...i}=e;return(0,r.jsx)("input",{type:s,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",o&&"border-red-500 focus-visible:ring-red-500",a),ref:t,...i})});o.displayName="Input"},6815:function(e,t,a){"use strict";a.d(t,{_:function(){return c}});var r=a(7437),s=a(2265),n=a(6394),o=a(535),i=a(4508);let l=(0,o.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.f,{ref:t,className:(0,i.cn)(l(),a),...s})});c.displayName=n.f.displayName},8730:function(e,t,a){"use strict";a.d(t,{H:function(){return d},a:function(){return u}});var r=a(7437),s=a(2265),n=a(9376),o=a(4131),i=a(9116),l=a(9064);let c=(0,s.createContext)(void 0);function d(e){let{children:t}=e,[a,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(!0),f=(0,n.useRouter)();(0,s.useEffect)(()=>{let e=o.Z.get("token");e?(i.hi.defaults.headers.common.Authorization="Bearer ".concat(e),h()):m(!1)},[]);let h=async()=>{try{let e=await i.hi.get("/auth/me");d(e.data.user)}catch(e){o.Z.remove("token"),delete i.hi.defaults.headers.common.Authorization}finally{m(!1)}},p=async(e,t)=>{try{let{token:a,user:r}=(await i.hi.post("/auth/login",{email:e,password:t})).data;o.Z.set("token",a,{expires:7}),i.hi.defaults.headers.common.Authorization="Bearer ".concat(a),d(r),l.ZP.success("Вход выполнен успешно!"),f.push("/dashboard")}catch(e){var a,r;throw l.ZP.error((null===(r=e.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:a.message)||"Ошибка входа"),e}},x=async e=>{try{let{user:t}=(await i.hi.post("/auth/register",e)).data;l.ZP.success("Код подтверждения отправлен на ваш email. Пожалуйста, введите его для завершения регистрации."),f.push("/verify-email/verify?email=".concat(encodeURIComponent(t.email)))}catch(e){var t,a;throw l.ZP.error((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"Ошибка регистрации"),e}},g=async(e,t)=>{try{await i.hi.post("/auth/verify-email",{email:e,code:t}),l.ZP.success("Email успешно подтвержден!"),a?await h():f.push("/login")}catch(e){var r,s;throw l.ZP.error((null===(s=e.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.message)||"Ошибка подтверждения email"),e}};return(0,r.jsx)(c.Provider,{value:{user:a,login:p,register:x,verifyEmail:g,logout:()=>{o.Z.remove("token"),delete i.hi.defaults.headers.common.Authorization,d(null),l.ZP.success("Вы успешно вышли из системы"),f.push("/")},loading:u},children:t})}function u(){let e=(0,s.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9116:function(e,t,a){"use strict";a.d(t,{PH:function(){return o},hi:function(){return n},zy:function(){return i}});var r=a(3464),s=a(257);let n=r.Z.create({baseURL:s.env.NEXT_PUBLIC_API_URL||"http://localhost:4100/api",headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>e,e=>Promise.reject(e)),n.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(window.location.href="/login"),Promise.reject(e)});let o={getRememberedAddresses:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=new URLSearchParams;return e&&a.append("city",e),a.append("limit",t.toString()),(await n.get("/addresses/remembered?".concat(a))).data},saveRememberedAddress:async e=>(await n.post("/addresses/remembered",e)).data,getPopularAddresses:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return(await n.get("/addresses/popular?limit=".concat(e))).data},searchAddresses:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return(await n.get("/addresses/search?q=".concat(encodeURIComponent(e),"&limit=").concat(t))).data}},i={getTrendingTopics:async()=>(await n.get("/recommendations/trending-topics")).data,getStats:async()=>(await n.get("/recommendations/stats")).data,getUserPreferences:async()=>(await n.get("/recommendations/user-preferences")).data}},8502:function(e,t,a){"use strict";a.d(t,{t:function(){return s}});class r{async searchCities(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a="city:".concat(e,":").concat(t);if(console.log("Searching cities for:",e),this.cache.has(a))return console.log("Using cached result for:",e),this.cache.get(a);try{let r=new URLSearchParams({name_startsWith:e,maxRows:t.toString(),username:"oktamov_shohjahon",featureClass:"P"}),s="".concat("http://api.geonames.org/searchJSON","?").concat(r);console.log("Calling GeoNames API:",s);let n=await fetch(s,{headers:{Accept:"application/json"}});if(!n.ok)throw Error("GeoNames API error: ".concat(n.status));let o=await n.json();if(console.log("GeoNames response:",o),Array.isArray(o.geonames)){let t=o.geonames.map(e=>({place_id:e.geonameId,display_name:"".concat(e.name).concat(e.adminName1?", "+e.adminName1:"").concat(e.countryName?", "+e.countryName:""),lat:e.lat,lon:e.lng,type:e.fcodeName,address:{city:e.name,state:e.adminName1,country:e.countryName}})),r={suggestions:t};return this.cache.set(a,r),console.log("Found",t.length,"cities for:",e),r}return{suggestions:[]}}catch(e){return console.error("Error searching cities:",e),{suggestions:[],error:"Failed to search cities"}}}async searchStreets(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r="street:".concat(e,":").concat(t,":").concat(a);if(this.cache.has(r))return this.cache.get(r);try{let s=new URLSearchParams({q:t?"".concat(e,", ").concat(t):e,format:"json",addressdetails:"1",limit:a.toString(),featuretype:"street"}),n=await fetch("".concat("https://nominatim.openstreetmap.org/search","?").concat(s),{headers:{Accept:"application/json","User-Agent":"ProKvartiru/1.0"}});if(!n.ok)throw Error("HTTP error! status: ".concat(n.status));let o={suggestions:(await n.json()).map(e=>({place_id:e.place_id,display_name:e.display_name,lat:e.lat,lon:e.lon,type:e.type,address:e.address||{}}))};return this.cache.set(r,o),o}catch(e){return console.error("Error searching streets:",e),{suggestions:[],error:"Failed to search streets"}}}async reverseGeocode(e,t){try{let a=new URLSearchParams({lat:e,lon:t,format:"json",addressdetails:"1"}),r=await fetch("".concat("https://nominatim.openstreetmap.org/reverse","?").concat(a),{headers:{Accept:"application/json","User-Agent":"ProKvartiru/1.0"}});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));let s=await r.json();return{place_id:s.place_id,display_name:s.display_name,lat:s.lat,lon:s.lon,type:s.type,address:s.address||{}}}catch(e){return console.error("Error reverse geocoding:",e),null}}clearCache(){this.cache.clear()}getCacheSize(){return this.cache.size}constructor(){this.cache=new Map}}let s=new r},4508:function(e,t,a){"use strict";a.d(t,{cn:function(){return n}});var r=a(1994),s=a(3335);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,r.W)(t))}}},function(e){e.O(0,[72,278,648,634,922,8,116,541,971,117,744],function(){return e(e.s=6330)}),_N_E=e.O()}]);