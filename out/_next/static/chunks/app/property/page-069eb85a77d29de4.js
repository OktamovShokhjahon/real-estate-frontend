(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[82],{6330:function(e,s,t){Promise.resolve().then(t.bind(t,4166))},4166:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return g}});var a=t(7437),r=t(2265),l=t(6484),i=t(9116),n=t(2869),c=t(5186),d=t(6815),m=t(6070),x=t(5974),o=t(3247),h=t(9397),u=t(3774),j=t(6595),p=t(1047),v=t(7648),y=t(8730),f=t(9376),N=t(4338);function g(){var e;let{user:s,loading:t}=(0,y.a)(),g=(0,f.useRouter)();if(!t&&!s)return g.push("/login"),null;if(t)return(0,a.jsx)("div",{className:"text-center py-16",children:"Загрузка..."});let[w,k]=(0,r.useState)({city:"",street:"",building:"",rooms:""}),{data:Z,isLoading:_,refetch:C}=(0,l.useQuery)(["property-reviews",w],async()=>{let e=new URLSearchParams;return Object.entries(w).forEach(s=>{let[t,a]=s;a&&e.append(t,a)}),(await i.hi.get("/property/reviews?".concat(e))).data}),S=e=>{k(s=>({...s,[e.target.name]:e.target.value}))};return(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Отзывы о недвижимости"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Ищите отзывы о квартирах, зданиях и районах"})]}),(0,a.jsxs)(m.Zb,{children:[(0,a.jsx)(m.Ol,{children:(0,a.jsxs)(m.ll,{className:"flex items-center",children:[(0,a.jsx)(o.Z,{className:"h-5 w-5 mr-2"}),"Поиск недвижимости"]})}),(0,a.jsx)(m.aY,{children:(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),C()},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsx)(N.S,{type:"city",value:w.city,onValueChange:e=>k(s=>({...s,city:e})),label:"Город",placeholder:"Поиск города..."})}),(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsx)(N.S,{type:"street",value:w.street,onValueChange:e=>k(s=>({...s,street:e})),cityValue:w.city,label:"Улица",placeholder:"Поиск улицы..."})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"building",children:"Здание"}),(0,a.jsx)(c.I,{id:"building",name:"building",value:w.building,onChange:S,placeholder:"Номер здания"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d._,{htmlFor:"rooms",children:"Комнаты"}),(0,a.jsx)(c.I,{id:"rooms",name:"rooms",type:"number",min:"1",max:"8",value:w.rooms,onChange:S,placeholder:"Количество комнат"})]})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)(n.z,{type:"submit",disabled:_,children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"Поиск"]}),(0,a.jsx)(n.z,{variant:"outline",asChild:!0,children:(0,a.jsxs)(v.default,{href:"/property/add",children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"Добавить отзыв"]})})]})]})})]}),_?(0,a.jsx)("div",{className:"text-center py-8",children:"Загрузка..."}):(0,a.jsx)("div",{className:"space-y-6",children:(null==Z?void 0:null===(e=Z.reviews)||void 0===e?void 0:e.length)>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Найдено ",Z.pagination.total," отзывов"]}),(0,a.jsx)("div",{className:"grid gap-6",children:Z.reviews.map(e=>(console.log(e),(0,a.jsxs)(m.Zb,{children:[(0,a.jsx)(m.Ol,{children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(m.ll,{className:"flex items-center",children:[(0,a.jsx)(u.Z,{className:"h-5 w-5 mr-2 text-blue-600"}),e.street," ",e.building,", ",e.city]}),(0,a.jsxs)(m.SZ,{className:"flex items-center mt-2",children:[(0,a.jsxs)(x.C,{variant:"secondary",className:"mr-2",children:[e.numberOfRooms," комнат"]}),e.rating&&(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 text-yellow-500 mr-1"}),(0,a.jsxs)("span",{children:[e.rating,"/5"]})]})]})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["от ",e.author.firstName," ",e.author.lastName]})]})}),(0,a.jsxs)(m.aY,{children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Период аренды: ",e.rentalPeriod.from.month,"/",e.rentalPeriod.from.year," -"," ",e.rentalPeriod.to.month,"/",e.rentalPeriod.to.year]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:["Арендодатель: ",e.landlordName]}),(0,a.jsx)("p",{className:"text-gray-700",children:e.reviewText})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["Опубликовано"," ",new Date(e.createdAt).toLocaleDateString()]})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"Комментарии"}),e.comments&&e.comments.filter(e=>e.isApproved).length>0?(0,a.jsx)("div",{className:"space-y-2",children:e.comments.length>0&&e.comments.filter(e=>e.isApproved).map(s=>(0,a.jsxs)("div",{className:"border rounded p-2 bg-gray-50 dark:bg-zinc-800 flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:[s.author.firstName," ",s.author.lastName," •"," ",new Date(s.createdAt).toLocaleString()]}),(0,a.jsx)("button",{className:"text-xs text-red-500 hover:underline ml-2",onClick:async()=>{await i.hi.post("/property/reviews/".concat(e._id,"/comments/").concat(s._id,"/report")),alert("Комментарий отправлен на модерацию")},title:"Пожаловаться на комментарий",children:"Пожаловаться"})]}),(0,a.jsx)("div",{className:"text-sm text-gray-800 dark:text-gray-100 mt-1",children:s.text})]},s._id))}):(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Комментариев пока нет."}),(0,a.jsx)(b,{reviewId:e._id})]})]})]},e._id)))})]}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"Отзывы не найдены"}),(0,a.jsx)(n.z,{asChild:!0,children:(0,a.jsxs)(v.default,{href:"/property/add",children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"Будьте первым, кто добавит отзыв"]})})]})})]})}function b(e){let{reviewId:s}=e,[t,l]=(0,r.useState)(""),[c,d]=(0,r.useState)(!1),[m,x]=(0,r.useState)(!1),o=async e=>{e.preventDefault(),d(!0),x(!1);try{await i.hi.post("/property/reviews/".concat(s,"/comments"),{text:t}),l(""),x(!0)}catch(e){alert("Ошибка при добавлении комментария")}finally{d(!1)}};return(0,a.jsxs)("form",{onSubmit:o,className:"mt-3 flex flex-col gap-2",children:[(0,a.jsx)("textarea",{className:"border rounded p-2 text-sm",rows:2,value:t,onChange:e=>l(e.target.value),placeholder:"Напишите комментарий...",required:!0,maxLength:1e3}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n.z,{type:"submit",size:"sm",disabled:c||!t.trim(),children:c?"Отправка...":"Добавить комментарий"}),m&&(0,a.jsx)("span",{className:"text-green-600 text-xs",children:"Комментарий отправлен на модерацию"})]})]})}},1047:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9205).Z)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},9397:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9205).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},6394:function(e,s,t){"use strict";t.d(s,{f:function(){return n}});var a=t(2265),r=t(6840),l=t(7437),i=a.forwardRef((e,s)=>(0,l.jsx)(r.WV.label,{...e,ref:s,onMouseDown:s=>{var t;s.target.closest("button, input, select, textarea")||(null===(t=e.onMouseDown)||void 0===t||t.call(e,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));i.displayName="Label";var n=i}},function(e){e.O(0,[72,278,648,634,550,116,320,384,971,117,744],function(){return e(e.s=6330)}),_N_E=e.O()}]);