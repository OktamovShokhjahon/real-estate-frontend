(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[650],{287:(e,r,a)=>{Promise.resolve().then(a.bind(a,9057))},9057:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>b});var l=a(5155),s=a(2115),t=a(63),n=a(2734),i=a(7621),d=a(7003),o=a(6170),c=a(235),m=a(7001),h=a(7507),u=a(3209),x=a(2663),g=a(9347);function p(e){let{value:r,onValueChange:a,label:s,placeholder:t="Выберите рейтинг",required:n=!1}=e;return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)(c.J,{htmlFor:s.toLowerCase().replace(/\s+/g,"-"),children:[s," ",n&&"*"]}),(0,l.jsxs)(h.l6,{value:r,onValueChange:a,children:[(0,l.jsx)(h.bq,{children:(0,l.jsx)(h.yv,{placeholder:t})}),(0,l.jsx)(h.gC,{children:[1,2,3,4,5].map(e=>(0,l.jsx)(h.eb,{value:e.toString(),children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"flex",children:Array.from({length:5},(r,a)=>(0,l.jsx)(g.A,{className:"h-3 w-3 ".concat(a<e?"text-yellow-500 fill-current":"text-gray-300")},a))}),(0,l.jsxs)("span",{children:[e," ",1===e?"звезда":e<5?"звезды":"звезд"]})]})},e))})]})]})}function v(e){let{value:r,onValueChange:a,label:t}=e,[n,i]=(0,s.useState)([]),[d,m]=(0,s.useState)(!1),[h,u]=(0,s.useState)(!1),[x,g]=(0,s.useState)(r),p=(0,s.useRef)(null),v=async e=>{m(!0);try{let r=await fetch("https://nominatim.openstreetmap.org/search?q=".concat(encodeURIComponent(e),"&format=json&addressdetails=1&limit=10&featuretype=city")),a=await r.json(),l=Array.isArray(a)?a.map(e=>e.display_name).filter(Boolean):[];console.log(l),i(l)}catch(e){i([])}m(!1)},j=e=>{g(e),a(e),u(!1)};return(0,l.jsxs)("div",{className:"relative",children:[t&&(0,l.jsx)(c.J,{htmlFor:"city",children:t}),(0,l.jsx)(o.p,{id:"city",name:"city",autoComplete:"off",ref:p,value:x,onChange:e=>{let r=e.target.value;g(r),r.length>0?(v(r),u(!0)):(i([]),u(!1))},onFocus:()=>{x.length>0&&u(!0)},onBlur:()=>{setTimeout(()=>{a(x.trim()),u(!1)},100)},required:!0,placeholder:"Введите город",className:"bg-white dark:bg-[#020817] text-black dark:text-white"}),h&&(n.length>0||x.trim().length>0)&&(0,l.jsxs)("div",{className:"absolute z-10 bg-white dark:bg-[#020817] border border-gray-200 dark:border-gray-700 rounded shadow w-full mt-1 max-h-48 overflow-auto",children:[d&&(0,l.jsx)("div",{className:"px-3 py-2 text-gray-500 dark:text-gray-300 text-sm",children:"Загрузка..."}),n.map(e=>(0,l.jsx)("div",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 text-black dark:text-white",onMouseDown:()=>j(e),children:e},e)),x.trim().length>0&&!n.includes(x.trim())&&(0,l.jsxs)("div",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 text-blue-600 dark:text-blue-400",onMouseDown:()=>j(x.trim()),children:["Добавить: ",(0,l.jsx)("b",{children:x.trim()})]})]})]})}function j(e){let{value:r,onValueChange:a,cityValue:t,label:n}=e,[i,d]=(0,s.useState)([]),[m,h]=(0,s.useState)(!1),[u,x]=(0,s.useState)(!1),[g,p]=(0,s.useState)(r),v=(0,s.useRef)(null),j=async e=>{h(!0);try{t&&"".concat(e,", ").concat(t);let r=await fetch("https://nominatim.openstreetmap.org/search?q=".concat(encodeURIComponent(g),"&format=json&addressdetails=1&limit=10&featuretype=street")),a=await r.json(),l=Array.isArray(a)?Array.from(new Set(a.map(e=>e.address&&e.address.road?e.address.road:e.display_name?e.display_name.split(",")[0]:null).filter(Boolean))):[];d(l)}catch(e){d([])}h(!1)},b=e=>{p(e),a(e),x(!1)};return(0,l.jsxs)("div",{className:"relative",children:[n&&(0,l.jsx)(c.J,{htmlFor:"street",children:n}),(0,l.jsx)(o.p,{id:"street",name:"street",autoComplete:"off",ref:v,value:g,onChange:e=>{let r=e.target.value;p(r),r.length>0?(j(r),x(!0)):(d([]),x(!1))},onFocus:()=>{g.length>0&&x(!0)},onBlur:()=>{setTimeout(()=>{a(g.trim()),x(!1)},100)},required:!0,placeholder:"Введите улицу",className:"bg-white dark:bg-[#020817] text-black dark:text-white"}),u&&(i.length>0||g.trim().length>0)&&(0,l.jsxs)("div",{className:"absolute z-10 bg-white dark:bg-[#020817] border border-gray-200 dark:border-gray-700 rounded shadow w-full mt-1 max-h-48 overflow-auto",children:[m&&(0,l.jsx)("div",{className:"px-3 py-2 text-gray-500 dark:text-gray-300 text-sm",children:"Загрузка..."}),i.map(e=>(0,l.jsx)("div",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 text-black dark:text-white",onMouseDown:()=>b(e),children:e},e)),g.trim().length>0&&!i.includes(g.trim())&&(0,l.jsxs)("div",{className:"px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 text-blue-600 dark:text-blue-400",onMouseDown:()=>b(g.trim()),children:["Добавить: ",(0,l.jsx)("b",{children:g.trim()})]})]})]})}function b(){let{user:e}=(0,n.A)(),r=(0,t.useRouter)(),[a,g]=(0,s.useState)(!1),[b,y]=(0,s.useState)({city:"",street:"",building:"",residentialComplex:"",floor:"",apartmentNumber:"",numberOfRooms:"",rentalPeriod:{from:{month:"",year:""},to:{month:"",year:""}},landlordName:"",reviewText:"",rating:"",ratings:{apartment:"",residentialComplex:"",courtyard:"",parking:"",infrastructure:""}}),[f,N]=(0,s.useState)(!1);if(!e)return r.push("/login.html"),null;let C=async e=>{if(e.preventDefault(),g(!0),!f&&!b.numberOfRooms){x.Ay.error("Пожалуйста, укажите количество комнат."),g(!1);return}if(!f&&!b.landlordName.trim()){x.Ay.error("Пожалуйста, укажите имя арендодателя."),g(!1);return}try{let e={...b,numberOfRooms:b.numberOfRooms?Number.parseInt(b.numberOfRooms):void 0,floor:b.floor?Number.parseInt(b.floor):void 0,rating:b.rating?Number.parseInt(b.rating):void 0,ratings:{apartment:b.ratings.apartment?Number.parseInt(b.ratings.apartment):void 0,residentialComplex:b.ratings.residentialComplex?Number.parseInt(b.ratings.residentialComplex):void 0,courtyard:b.ratings.courtyard?Number.parseInt(b.ratings.courtyard):void 0,parking:b.ratings.parking?Number.parseInt(b.ratings.parking):void 0,infrastructure:b.ratings.infrastructure?Number.parseInt(b.ratings.infrastructure):void 0},rentalPeriod:{from:{month:Number.parseInt(b.rentalPeriod.from.month),year:Number.parseInt(b.rentalPeriod.from.year)},to:{month:Number.parseInt(b.rentalPeriod.to.month),year:Number.parseInt(b.rentalPeriod.to.year)}},isResidentialComplexOnly:f};await i.FH.post("/property/reviews",e);try{await i.hA.saveRememberedAddress({city:b.city,street:b.street,building:b.building,residentialComplex:b.residentialComplex})}catch(e){console.error("Error saving remembered address:",e)}x.Ay.success("Отзыв успешно отправлен!"),r.push("/property.html")}catch(e){var a,l;x.Ay.error((null==(l=e.response)||null==(a=l.data)?void 0:a.message)||"Не удалось отправить отзыв")}finally{g(!1)}},w=e=>{let{name:r,value:a}=e.target;if(r.includes(".")){let[e,l,s]=r.split(".");y(r=>({...r,[e]:{...r[e],[l]:s?{...r[e][l],[s]:a}:a}}))}else y(e=>({...e,[r]:a}))},k=new Date().getFullYear(),P=Array.from({length:50},(e,r)=>k-r),S=[{value:"1",label:"Январь"},{value:"2",label:"Февраль"},{value:"3",label:"Март"},{value:"4",label:"Апрель"},{value:"5",label:"Май"},{value:"6",label:"Июнь"},{value:"7",label:"Июль"},{value:"8",label:"Август"},{value:"9",label:"Сентябрь"},{value:"10",label:"Октябрь"},{value:"11",label:"Ноябрь"},{value:"12",label:"Декабрь"}];return(0,l.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,l.jsxs)(u.Zp,{children:[(0,l.jsxs)(u.aR,{children:[(0,l.jsx)(u.ZB,{children:"Добавить отзыв о недвижимости"}),(0,l.jsx)(u.BT,{children:"Поделитесь своим опытом аренды недвижимости"})]}),(0,l.jsx)(u.Wu,{children:(0,l.jsxs)("form",{onSubmit:C,className:"space-y-6",children:[(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"Данные о недвижимости"}),(0,l.jsxs)("div",{className:"mb-2",children:[(0,l.jsxs)("label",{className:"inline-flex items-center space-x-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:f,onChange:e=>{N(e.target.checked),e.target.checked&&y(e=>({...e,numberOfRooms:"",landlordName:""}))}}),(0,l.jsx)("span",{children:"Я хочу оставить отзыв только о жилом комплексе (ЖК)"})]}),(0,l.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:'Если вы не указываете квартиру, поля "количество комнат", "этаж", "номер квартиры" не обязательны. Имя арендодателя также не обязательно.'})]}),(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,l.jsx)("div",{className:"space-y-2",children:(0,l.jsx)(v,{value:b.city,onValueChange:e=>{y(r=>({...r,city:e,street:""}))},label:"Город *"})}),(0,l.jsx)("div",{className:"space-y-2",children:(0,l.jsx)(j,{value:b.street,onValueChange:e=>{y(r=>({...r,street:e}))},cityValue:b.city,label:"Улица *"})})]}),(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(c.J,{htmlFor:"building",children:"Дом *"}),(0,l.jsx)(o.p,{id:"building",name:"building",value:b.building,onChange:w,required:!0})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(c.J,{htmlFor:"residentialComplex",children:"Жилой комплекс"}),(0,l.jsx)(o.p,{id:"residentialComplex",name:"residentialComplex",value:b.residentialComplex,onChange:w,placeholder:"Название жилого комплекса (необязательно)"})]})]}),(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(c.J,{htmlFor:"floor",children:"Этаж"}),(0,l.jsx)(o.p,{id:"floor",name:"floor",type:"number",value:b.floor,onChange:w,disabled:f})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(c.J,{htmlFor:"apartmentNumber",children:"Номер квартиры"}),(0,l.jsx)(o.p,{id:"apartmentNumber",name:"apartmentNumber",value:b.apartmentNumber,onChange:w,disabled:f})]})]}),!f&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(c.J,{htmlFor:"numberOfRooms",children:"Количество комнат *"}),(0,l.jsxs)(h.l6,{value:b.numberOfRooms,onValueChange:e=>y(r=>({...r,numberOfRooms:e})),children:[(0,l.jsx)(h.bq,{children:(0,l.jsx)(h.yv,{placeholder:"Выберите количество комнат"})}),(0,l.jsx)(h.gC,{children:[1,2,3,4,5,6,7,8].map(e=>(0,l.jsxs)(h.eb,{value:e.toString(),children:[e," ",1===e?"комната":e<5?"комнаты":"комнат"]},e))})]})]})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"Период аренды"}),(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)(c.J,{children:"С *"}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,l.jsxs)(h.l6,{value:b.rentalPeriod.from.month,onValueChange:e=>y(r=>({...r,rentalPeriod:{...r.rentalPeriod,from:{...r.rentalPeriod.from,month:e}}})),children:[(0,l.jsx)(h.bq,{children:(0,l.jsx)(h.yv,{placeholder:"Месяц"})}),(0,l.jsx)(h.gC,{children:S.map(e=>(0,l.jsx)(h.eb,{value:e.value,children:e.label},e.value))})]}),(0,l.jsxs)(h.l6,{value:b.rentalPeriod.from.year,onValueChange:e=>y(r=>({...r,rentalPeriod:{...r.rentalPeriod,from:{...r.rentalPeriod.from,year:e}}})),children:[(0,l.jsx)(h.bq,{children:(0,l.jsx)(h.yv,{placeholder:"Год"})}),(0,l.jsx)(h.gC,{children:P.map(e=>(0,l.jsx)(h.eb,{value:e.toString(),children:e},e))})]})]})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)(c.J,{children:"По *"}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,l.jsxs)(h.l6,{value:b.rentalPeriod.to.month,onValueChange:e=>y(r=>({...r,rentalPeriod:{...r.rentalPeriod,to:{...r.rentalPeriod.to,month:e}}})),children:[(0,l.jsx)(h.bq,{children:(0,l.jsx)(h.yv,{placeholder:"Месяц"})}),(0,l.jsx)(h.gC,{children:S.map(e=>(0,l.jsx)(h.eb,{value:e.value,children:e.label},e.value))})]}),(0,l.jsxs)(h.l6,{value:b.rentalPeriod.to.year,onValueChange:e=>y(r=>({...r,rentalPeriod:{...r.rentalPeriod,to:{...r.rentalPeriod.to,year:e}}})),children:[(0,l.jsx)(h.bq,{children:(0,l.jsx)(h.yv,{placeholder:"Год"})}),(0,l.jsx)(h.gC,{children:P.map(e=>(0,l.jsx)(h.eb,{value:e.toString(),children:e},e))})]})]})]})]})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"Детали отзыва"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)(c.J,{htmlFor:"landlordName",children:["Имя арендодателя",!f&&(0,l.jsx)("span",{children:" *"})]}),(0,l.jsx)(o.p,{id:"landlordName",name:"landlordName",value:b.landlordName,onChange:w,required:!f,disabled:f,placeholder:f?"Необязательно для отзыва о ЖК":void 0})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h4",{className:"text-md font-medium",children:"Рейтинги (необязательно)"}),(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,l.jsx)(p,{value:b.ratings.apartment,onValueChange:e=>y(r=>({...r,ratings:{...r.ratings,apartment:e}})),label:"Квартира",placeholder:"Оцените квартиру"}),(0,l.jsx)(p,{value:b.ratings.residentialComplex,onValueChange:e=>y(r=>({...r,ratings:{...r.ratings,residentialComplex:e}})),label:"Жилой комплекс",placeholder:"Оцените жилой комплекс"}),(0,l.jsx)(p,{value:b.ratings.courtyard,onValueChange:e=>y(r=>({...r,ratings:{...r.ratings,courtyard:e}})),label:"Двор",placeholder:"Оцените двор"}),(0,l.jsx)(p,{value:b.ratings.parking,onValueChange:e=>y(r=>({...r,ratings:{...r.ratings,parking:e}})),label:"Парковка",placeholder:"Оцените парковку"}),(0,l.jsx)(p,{value:b.ratings.infrastructure,onValueChange:e=>y(r=>({...r,ratings:{...r.ratings,infrastructure:e}})),label:"Инфраструктура",placeholder:"Оцените инфраструктуру"})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(c.J,{htmlFor:"reviewText",children:"Отзыв *"}),(0,l.jsx)(m.T,{id:"reviewText",name:"reviewText",value:b.reviewText,onChange:w,placeholder:"Опишите квартиру, все плюсы и минусы за время аренды, а также ваш опыт взаимодействия с арендодателем.",rows:6,maxLength:5e3,required:!0}),(0,l.jsxs)("div",{className:"text-sm text-gray-500 text-right",children:[b.reviewText.length,"/5000 символов"]})]})]}),(0,l.jsx)(d.$,{type:"submit",className:"w-full",disabled:a,children:a?"Отправка...":"Отправить отзыв"})]})})]})})}},9347:(e,r,a)=>{"use strict";a.d(r,{A:()=>l});let l=(0,a(1847).A)("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]])}},e=>{e.O(0,[783,812,395,93,15,92,441,255,358],()=>e(e.s=287)),_N_E=e.O()}]);