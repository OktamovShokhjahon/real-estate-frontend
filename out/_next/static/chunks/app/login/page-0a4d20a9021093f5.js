(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{235:(e,t,r)=>{"use strict";r.d(t,{J:()=>d});var a=r(5155),s=r(2115),i=r(489),n=r(3101),o=r(5016);let l=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(i.b,{ref:t,className:(0,o.cn)(l(),r),...s})});d.displayName=i.b.displayName},489:(e,t,r)=>{"use strict";r.d(t,{b:()=>o});var a=r(2115),s=r(7602),i=r(5155),n=a.forwardRef((e,t)=>(0,i.jsx)(s.sG.label,{...e,ref:t,onMouseDown:t=>{var r;t.target.closest("button, input, select, textarea")||(null==(r=e.onMouseDown)||r.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));n.displayName="Label";var o=n},1860:(e,t,r)=>{Promise.resolve().then(r.bind(r,5777))},2734:(e,t,r)=>{"use strict";r.d(t,{A:()=>m,O:()=>c});var a=r(5155),s=r(2115),i=r(63),n=r(2378),o=r(7621),l=r(2663),d=r(5016);let u=(0,s.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,s.useState)(null),[m,p]=(0,s.useState)(!0),[g,f]=(0,s.useState)(!1),h=(0,i.useRouter)();(0,s.useEffect)(()=>{let e=n.A.get("token");e?(o.FH.defaults.headers.common.Authorization="Bearer ".concat(e),v()):p(!1)},[]);let v=async()=>{try{let e=await o.FH.get("/auth/me");c(e.data.user)}catch(e){n.A.remove("token"),delete o.FH.defaults.headers.common.Authorization,c(null)}finally{p(!1)}},x=async(e,t)=>{f(!0);try{let{token:r,user:a}=(await o.FH.post("/auth/login",{email:e,password:t})).data;o.FH.defaults.headers.common.Authorization="Bearer ".concat(r),c(a),l.Ay.success("Вход выполнен успешно!"),h.push((0,d.Y)("/dashboard"))}catch(e){var r,a,s,i,n,u;throw console.error("Login error:",e),(null==(r=e.response)?void 0:r.status)===401?l.Ay.error("Неверные учетные данные"):(null==(a=e.response)?void 0:a.status)===0||"NETWORK_ERROR"===e.code?l.Ay.error("Ошибка сети. Проверьте подключение к интернету."):(null==(s=e.message)?void 0:s.includes("cookie"))||(null==(i=e.message)?void 0:i.includes("CORS"))?l.Ay.error("Ошибка браузера. Попробуйте обновить страницу или использовать другой браузер."):l.Ay.error((null==(u=e.response)||null==(n=u.data)?void 0:n.message)||"Ошибка входа"),e}finally{f(!1)}},y=async e=>{f(!0);try{let{user:t}=(await o.FH.post("/auth/register",e)).data;l.Ay.success("Код подтверждения отправлен на ваш email. Пожалуйста, введите его для завершения регистрации."),h.push("".concat((0,d.Y)("/verify-email/verify"),"?email=").concat(encodeURIComponent(t.email)))}catch(e){var t,r,a,s,i,n,u,c;throw console.error("Register error:",e),(null==(t=e.response)?void 0:t.status)===400?l.Ay.error((null==(n=e.response)||null==(i=n.data)?void 0:i.message)||"Ошибка валидации данных"):(null==(r=e.response)?void 0:r.status)===0||"NETWORK_ERROR"===e.code?l.Ay.error("Ошибка сети. Проверьте подключение к интернету."):(null==(a=e.message)?void 0:a.includes("cookie"))||(null==(s=e.message)?void 0:s.includes("CORS"))?l.Ay.error("Ошибка браузера. Попробуйте обновить страницу или использовать другой браузер."):l.Ay.error((null==(c=e.response)||null==(u=c.data)?void 0:u.message)||"Ошибка регистрации"),e}finally{f(!1)}},b=async(e,t)=>{f(!0);try{await o.FH.post("/auth/verify-email",{email:e,code:t}),l.Ay.success("Email успешно подтвержден!"),r?await v():h.push((0,d.Y)("/login"))}catch(e){var a,s;throw l.Ay.error((null==(s=e.response)||null==(a=s.data)?void 0:a.message)||"Ошибка подтверждения email"),e}finally{f(!1)}};return(0,a.jsx)(u.Provider,{value:{user:r,isLoading:m,loading:g,login:x,register:y,verifyEmail:b,logout:()=>{n.A.remove("token",{path:"/"}),delete o.FH.defaults.headers.common.Authorization,c(null),l.Ay.success("Вы успешно вышли из системы"),h.push("/")}},children:t})}function m(){let e=(0,s.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},3209:(e,t,r)=>{"use strict";r.d(t,{BT:()=>d,Wu:()=>u,ZB:()=>l,Zp:()=>n,aR:()=>o});var a=r(5155),s=r(2115),i=r(5016);let n=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});n.displayName="Card";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r),...s})});o.displayName="CardHeader";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});l.displayName="CardTitle";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",r),...s})});d.displayName="CardDescription";let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",r),...s})});u.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter"},5016:(e,t,r)=>{"use strict";r.d(t,{Y:()=>n,cn:()=>i});var a=r(2821),s=r(5889);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}function n(e){return e}},5777:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>w});var a=r(5155),s=r(2115),i=r(2619),n=r.n(i),o=r(2734),l=r(7003),d=r(6170),u=r(235),c=r(3209);let m="\\u0400-\\u04FF\\u0500-\\u052F\\u2DE0-\\u2DFF\\uA640-\\uA69F\\u1C80-\\u1C8F",p={email:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,password:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{8,}$/,name:new RegExp("^[a-zA-Z".concat(m,"\\s\\-']{2,50}$")),city:new RegExp("^[a-zA-Z".concat(m,"\\s\\-.]{2,100}$")),street:new RegExp("^[a-zA-Z".concat(m,"0-9\\s\\-.,']{2,200}$")),building:new RegExp("^[a-zA-Z".concat(m,"0-9\\s\\-.,'/]{1,50}$")),apartmentNumber:/^[a-zA-Z0-9-]{1,20}$/,floor:/^-?[0-9]{1,3}$/,phone:/^[+]?[1-9][\d]{0,15}$/,phoneLastFour:/^[0-9]{4}$/,idLastFour:/^[0-9]{4}$/,landlordName:new RegExp("^[a-zA-Z".concat(m,"\\s\\-.']{2,100}$")),reviewText:new RegExp("^[\\w".concat(m,"\\s.,!?;:\\-'\"$$$$[\\]/&%$#@+=*]{10,5000}$")),rating:/^[1-5]$/,year:new RegExp("^(19[0-9]{2}|20[0-9]{2}|".concat(new Date().getFullYear()+1,")$")),month:/^(1[0-2]|[1-9])$/,numberOfRooms:/^[1-8]$/,searchQuery:new RegExp("^[a-zA-Z".concat(m,"0-9\\s\\-']{1,100}$")),commentText:new RegExp("^[\\w".concat(m,"\\s.,!?;:\\-'\"$$$$[\\]/&%$#@+=*]{1,1000}$")),tenantFullName:new RegExp("^[a-zA-Z".concat(m,"\\s\\-'.]{2,100}$")),url:/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)$/,username:/^[a-zA-Z0-9_-]{3,30}$/,postalCode:/^[a-zA-Z0-9\s-]{3,10}$/,hexColor:/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/},g={isValidEmail:e=>p.email.test(e),isValidPassword:e=>p.password.test(e),isValidName:e=>p.name.test(e),isValidCity:e=>p.city.test(e),isValidStreet:e=>p.street.test(e),isValidBuilding:e=>p.building.test(e),isValidApartmentNumber:e=>p.apartmentNumber.test(e),isValidFloor:e=>p.floor.test(e.toString()),isValidPhone:e=>p.phone.test(e),isValidPhoneLastFour:e=>p.phoneLastFour.test(e),isValidIdLastFour:e=>p.idLastFour.test(e),isValidLandlordName:e=>p.landlordName.test(e),isValidReviewText:e=>p.reviewText.test(e),isValidRating:e=>p.rating.test(e.toString()),isValidYear:e=>p.year.test(e.toString()),isValidMonth:e=>p.month.test(e.toString()),isValidNumberOfRooms:e=>p.numberOfRooms.test(e.toString()),isValidUrl:e=>p.url.test(e),isValidUsername:e=>p.username.test(e),isValidPostalCode:e=>p.postalCode.test(e),isValidHexColor:e=>p.hexColor.test(e),isValidTenantFullName:e=>p.tenantFullName.test(e),isValidSearchQuery:e=>p.searchQuery.test(e),isValidCommentText:e=>p.commentText.test(e)},f={sanitizeEmail:e=>"string"!=typeof e?"":e.trim().toLowerCase().substring(0,254)},h={email:{required:"Email обязателен",invalid:"Пожалуйста, введите корректный email адрес"},password:{required:"Пароль обязателен",invalid:"Пароль должен содержать минимум 8 символов с заглавными буквами, строчными буквами и цифрами",minLength:"Пароль должен содержать минимум 8 символов"},name:{required:"Имя обязательно",invalid:"Имя может содержать только буквы, пробелы, дефисы и апострофы",minLength:"Имя должно содержать минимум 2 символа",maxLength:"Имя не должно превышать 50 символов"},city:{required:"Город обязателен",invalid:"Название города содержит недопустимые символы",minLength:"Название города должно содержать минимум 2 символа",maxLength:"Название города не должно превышать 100 символов"},street:{required:"Улица обязательна",invalid:"Название улицы содержит недопустимые символы",minLength:"Название улицы должно содержать минимум 2 символа",maxLength:"Название улицы не должно превышать 200 символов"},building:{required:"Здание обязательно",invalid:"Название/номер здания содержит недопустимые символы",minLength:"Здание должно содержать минимум 1 символ",maxLength:"Здание не должно превышать 50 символов"},apartmentNumber:{invalid:"Номер квартиры содержит недопустимые символы",maxLength:"Номер квартиры не должен превышать 20 символов"},floor:{invalid:"Этаж должен быть корректным числом"},phoneLastFour:{required:"Последние четыре цифры телефона обязательны",invalid:"Последние четыре цифры телефона должны быть ровно 4 цифрами"},idLastFour:{required:"Последние четыре цифры ID обязательны",invalid:"Последние четыре цифры ID должны быть ровно 4 цифрами"},landlordName:{required:"Имя арендодателя обязательно",invalid:"Имя арендодателя содержит недопустимые символы",minLength:"Имя арендодателя должно содержать минимум 2 символа",maxLength:"Имя арендодателя не должно превышать 100 символов"},reviewText:{required:"Текст отзыва обязателен",invalid:"Текст отзыва содержит недопустимые символы",minLength:"Текст отзыва должен содержать минимум 10 символов",maxLength:"Текст отзыва не должен превышать 5000 символов"},rating:{invalid:"Рейтинг должен быть от 1 до 5"},year:{required:"Год обязателен",invalid:"Пожалуйста, введите корректный год"},month:{required:"Месяц обязателен",invalid:"Пожалуйста, выберите корректный месяц"},numberOfRooms:{required:"Количество комнат обязательно",invalid:"Количество комнат должно быть от 1 до 8"},tenantFullName:{required:"Полное имя арендатора обязательно",invalid:"Полное имя арендатора содержит недопустимые символы",minLength:"Полное имя арендатора должно содержать минимум 2 символа",maxLength:"Полное имя арендатора не должно превышать 100 символов"},commentText:{required:"Текст комментария обязателен",invalid:"Текст комментария содержит недопустимые символы",minLength:"Комментарий должен содержать минимум 1 символ",maxLength:"Комментарий не должен превышать 1000 символов"},searchQuery:{invalid:"Поисковый запрос содержит недопустимые символы",maxLength:"Поисковый запрос не должен превышать 100 символов"}},v=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=h[t];if(r&&(!e||""===e.trim()))return a&&"required"in a?a.required:"This field is required";if(!e||""===e.trim())return null;let s=g["isValid".concat(t.charAt(0).toUpperCase()+t.slice(1))];return s&&!s(e)?a.invalid||"Invalid format":null};var x=r(63),y=r(5016);function b(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function w(){let[e,t]=(0,s.useState)({email:"",password:""}),[r,i]=(0,s.useState)({}),[m,p]=(0,s.useState)(!1),[g,h]=(0,s.useState)(null),{login:w}=(0,o.A)();(0,x.useRouter)();let A={email:{type:"email",required:!0},password:{type:"password",required:!0}},N=async t=>{t.preventDefault();let r={email:f.sanitizeEmail(e.email),password:e.password},a=((e,t)=>{let r={};for(let[a,s]of Object.entries(t)){let t=v(e[a],s.type,s.required);t&&(r[a]=t)}return r})(r,A);if(Object.keys(a).length>0)return void i(a);i({}),p(!0),h(null),b()&&(console.log("Mobile browser detected:",navigator.userAgent),console.log("Cookies enabled:",navigator.cookieEnabled));try{await w(r.email,r.password)}catch(e){b()&&(console.error("Mobile login error:",e),h("Ошибка входа на мобильном устройстве. Проверьте, разрешены ли cookies в вашем браузере. Если проблема сохраняется, попробуйте использовать другой браузер или обновить страницу."))}finally{p(!1)}},R=e=>{let{name:a,value:s}=e.target;t(e=>({...e,[a]:s})),r[a]&&i(e=>({...e,[a]:""})),g&&h(null)};return(0,a.jsx)("div",{className:"max-w-md mx-auto mt-16",children:(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsx)(c.ZB,{children:"Вход"}),(0,a.jsx)(c.BT,{children:"Введите ваши учетные данные для доступа к аккаунту"})]}),(0,a.jsxs)(c.Wu,{children:[(0,a.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"email",children:"Email"}),(0,a.jsx)(d.p,{id:"email",name:"email",type:"email",value:e.email,onChange:R,required:!0,autoComplete:"username",inputMode:"email",className:r.email?"border-red-500":""}),r.email&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:r.email})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"password",children:"Пароль"}),(0,a.jsx)(d.p,{id:"password",name:"password",type:"password",value:e.password,onChange:R,required:!0,autoComplete:"current-password",className:r.password?"border-red-500":""}),r.password&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:r.password})]}),g&&(0,a.jsx)("div",{className:"text-sm text-orange-600 bg-orange-50 rounded p-2",children:g}),(0,a.jsx)(l.$,{type:"submit",className:"w-full",disabled:m,children:m?"Вход...":"Войти"})]}),(0,a.jsxs)("div",{className:"mt-4 text-center text-sm",children:["Нет аккаунта? ",(0,a.jsx)(n(),{href:(0,y.Y)("/register"),className:"text-blue-600 hover:underline",children:"Зарегистрироваться"})]})]})]})})}},6170:(e,t,r)=>{"use strict";r.d(t,{p:()=>n});var a=r(5155),s=r(2115),i=r(5016);let n=s.forwardRef((e,t)=>{let{className:r,type:s,error:n,...o}=e;return(0,a.jsx)("input",{type:s,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n&&"border-red-500 focus-visible:ring-red-500",r),ref:t,...o})});n.displayName="Input"},7003:(e,t,r)=>{"use strict";r.d(t,{$:()=>d});var a=r(5155),s=r(2115),i=r(2467),n=r(3101),o=r(5016);let l=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,t)=>{let{className:r,variant:s,size:n,asChild:d=!1,...u}=e,c=d?i.DX:"button";return(0,a.jsx)(c,{className:(0,o.cn)(l({variant:s,size:n,className:r})),ref:t,...u})});d.displayName="Button"},7621:(e,t,r)=>{"use strict";r.d(t,{FH:()=>i,G9:()=>o,hA:()=>n});var a=r(5125),s=r(5704);let i=a.A.create({baseURL:s.env.NEXT_PUBLIC_API_URL||"https://prokvartiru.kz/api",headers:{"Content-Type":"application/json"},withCredentials:!0});i.interceptors.request.use(e=>e,e=>Promise.reject(e)),i.interceptors.response.use(e=>e,e=>Promise.reject(e));let n={getRememberedAddresses:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=new URLSearchParams;return e&&r.append("city",e),r.append("limit",t.toString()),(await i.get("/addresses/remembered?".concat(r))).data},saveRememberedAddress:async e=>(await i.post("/addresses/remembered",e)).data,getPopularAddresses:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return(await i.get("/addresses/popular?limit=".concat(e))).data},searchAddresses:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return(await i.get("/addresses/search?q=".concat(encodeURIComponent(e),"&limit=").concat(t))).data}},o={getTrendingTopics:async()=>(await i.get("/recommendations/trending-topics")).data,getStats:async()=>(await i.get("/recommendations/stats")).data,getUserPreferences:async()=>(await i.get("/recommendations/user-preferences")).data}}},e=>{e.O(0,[783,812,619,441,255,358],()=>e(e.s=1860)),_N_E=e.O()}]);