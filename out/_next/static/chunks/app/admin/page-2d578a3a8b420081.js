(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{652:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>$});var t=a(5155),l=a(2734),r=a(7812),i=a(923),n=a(534),c=a(6983),d=a(1169),x=a(2056),m=a(5937),o=a(63),h=a(5108),u=a(7621),j=a(3209),p=a(1873),v=a(508),g=a(1524),N=a(6485),f=a(906),y=a(9715);function w(){let{data:e,isLoading:s}=(0,h.useQuery)("activity-stats",async()=>(await u.FH.get("/admin/activity-stats")).data);if(s)return(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{className:"animate-pulse",children:[(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/2"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]}),(0,t.jsx)(j.Wu,{children:(0,t.jsx)("div",{className:"h-64 bg-gray-200 rounded animate-pulse"})})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{className:"animate-pulse",children:[(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/2"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]}),(0,t.jsx)(j.Wu,{children:(0,t.jsx)("div",{className:"h-64 bg-gray-200 rounded animate-pulse"})})]})]});let a=(null==e?void 0:e.dailyActivity)||[],l=a.reduce((e,s)=>({users:e.users+s.users,propertyReviews:e.propertyReviews+s.propertyReviews,tenantReviews:e.tenantReviews+s.tenantReviews}),{users:0,propertyReviews:0,tenantReviews:0}),r=Math.max(...a.map(e=>Math.max(e.users,e.propertyReviews,e.tenantReviews)));return 0===a.length?(0,t.jsxs)(j.Zp,{children:[(0,t.jsx)(j.aR,{children:(0,t.jsxs)(j.ZB,{className:"flex items-center",children:[(0,t.jsx)(f.A,{className:"h-5 w-5 mr-2"}),"Дневная активность"]})}),(0,t.jsx)(j.Wu,{children:(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(f.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{children:"Нет доступных данных об активности"})]})})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(j.ZB,{className:"text-sm font-medium",children:"Регистрации пользователей за 30 дней"}),(0,t.jsx)(d.A,{className:"h-4 w-4 text-blue-600"})]}),(0,t.jsxs)(j.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:l.users}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["В среднем ",Math.round(l.users/30)," в день"]})]})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(j.ZB,{className:"text-sm font-medium",children:"Отзывы о недвижимости за 30 дней"}),(0,t.jsx)(y.A,{className:"h-4 w-4 text-green-600"})]}),(0,t.jsxs)(j.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:l.propertyReviews}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["В среднем ",Math.round(l.propertyReviews/30)," в день"]})]})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(j.ZB,{className:"text-sm font-medium",children:"Отзывы о жильцах за 30 дней"}),(0,t.jsx)(y.A,{className:"h-4 w-4 text-purple-600"})]}),(0,t.jsxs)(j.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:l.tenantReviews}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["В среднем ",Math.round(l.tenantReviews/30)," в день"]})]})]})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{children:[(0,t.jsxs)(j.ZB,{className:"flex items-center",children:[(0,t.jsx)(f.A,{className:"h-5 w-5 mr-2"}),"Дневная активность (последние 30 дней)"]}),(0,t.jsx)(j.BT,{children:"Регистрации пользователей и публикация отзывов по дням"})]}),(0,t.jsx)(j.Wu,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap gap-6 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded mr-2"}),(0,t.jsx)("span",{children:"Пользователи"})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded mr-2"}),(0,t.jsx)("span",{children:"Отзывы о недвижимости"})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-3 h-3 bg-purple-500 rounded mr-2"}),(0,t.jsx)("span",{children:"Отзывы о жильцах"})]})]}),(0,t.jsx)("div",{className:"h-64 flex items-end justify-between space-x-1 bg-gray-50 p-4 rounded-lg overflow-x-auto",children:a.map((e,s)=>(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-1 min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"flex items-end space-x-0.5 h-48",children:[(0,t.jsx)("div",{className:"bg-blue-500 rounded-t w-2 transition-all duration-300 hover:bg-blue-600",style:{height:r>0?"".concat(e.users/r*100,"%"):"0%"},title:"".concat(e.users," пользователей")}),(0,t.jsx)("div",{className:"bg-green-500 rounded-t w-2 transition-all duration-300 hover:bg-green-600",style:{height:r>0?"".concat(e.propertyReviews/r*100,"%"):"0%"},title:"".concat(e.propertyReviews," отзывов о недвижимости")}),(0,t.jsx)("div",{className:"bg-purple-500 rounded-t w-2 transition-all duration-300 hover:bg-purple-600",style:{height:r>0?"".concat(e.tenantReviews/r*100,"%"):"0%"},title:"".concat(e.tenantReviews," отзывов о жильцах")})]}),(0,t.jsx)("div",{className:"text-xs text-gray-500 transform -rotate-45 origin-top-left whitespace-nowrap",children:new Date(e.date).toLocaleDateString("ru-RU",{month:"short",day:"numeric"})})]},e.date))}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-6",children:[(0,t.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-blue-900",children:"День пика регистраций пользователей"}),(0,t.jsx)("p",{className:"text-xs text-blue-700",children:a.length>0?new Date(a.reduce((e,s)=>s.users>e.users?s:e).date).toLocaleDateString("ru-RU",{year:"numeric",month:"short",day:"numeric"}):"Н/Д"})]}),(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:a.length>0?Math.max(...a.map(e=>e.users)):0})]})}),(0,t.jsx)("div",{className:"bg-green-50 p-4 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-green-900",children:"День пика отзывов"}),(0,t.jsx)("p",{className:"text-xs text-green-700",children:a.length>0?new Date(a.reduce((e,s)=>s.propertyReviews+s.tenantReviews>e.propertyReviews+e.tenantReviews?s:e).date).toLocaleDateString("ru-RU",{year:"numeric",month:"short",day:"numeric"}):"Н/Д"})]}),(0,t.jsx)("div",{className:"text-2xl font-bold text-green-600",children:a.length>0?Math.max(...a.map(e=>e.propertyReviews+e.tenantReviews)):0})]})})]})]})})]})]})}var b=a(1871);function R(){var e,s;let{data:a,isLoading:l}=(0,h.useQuery)("city-stats",async()=>(await u.FH.get("/admin/city-stats")).data);if(l)return(0,t.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{className:"animate-pulse",children:[(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/2"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]}),(0,t.jsx)(j.Wu,{children:(0,t.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,t.jsx)("div",{className:"h-12 bg-gray-200 rounded animate-pulse"},s))})})]})});let i=(null==a?void 0:a.cities)||[],n=i.slice(0,10),c=i.reduce((e,s)=>e+s.totalReviews,0),x=i.length,m=x>0?Math.round(c/x):0;return 0===i.length?(0,t.jsxs)(j.Zp,{children:[(0,t.jsx)(j.aR,{children:(0,t.jsxs)(j.ZB,{className:"flex items-center",children:[(0,t.jsx)(p.A,{className:"h-5 w-5 mr-2"}),"Статистика по городам"]})}),(0,t.jsx)(j.Wu,{children:(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(p.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{children:"Нет данных по городам"})]})})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(j.ZB,{className:"text-sm font-medium",children:"Всего городов"}),(0,t.jsx)(p.A,{className:"h-4 w-4 text-blue-600"})]}),(0,t.jsxs)(j.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:x}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"С отзывами"})]})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(j.ZB,{className:"text-sm font-medium",children:"Всего отзывов"}),(0,t.jsx)(b.A,{className:"h-4 w-4 text-green-600"})]}),(0,t.jsxs)(j.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:c.toLocaleString()}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Во всех городах"})]})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(j.ZB,{className:"text-sm font-medium",children:"Среднее на город"}),(0,t.jsx)(g.A,{className:"h-4 w-4 text-purple-600"})]}),(0,t.jsxs)(j.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:m}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Отзывов на город"})]})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(j.ZB,{className:"text-sm font-medium",children:"Топ город"}),(0,t.jsx)(d.A,{className:"h-4 w-4 text-orange-600"})]}),(0,t.jsxs)(j.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:(null==(e=n[0])?void 0:e.totalReviews)||0}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:(null==(s=n[0])?void 0:s.city)||"Н/Д"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{children:[(0,t.jsxs)(j.ZB,{className:"flex items-center",children:[(0,t.jsx)(p.A,{className:"h-5 w-5 mr-2"}),"Топ городов по количеству отзывов"]}),(0,t.jsx)(j.BT,{children:"Города с наибольшим количеством отзывов о недвижимости и жильцах"})]}),(0,t.jsx)(j.Wu,{children:(0,t.jsx)("div",{className:"space-y-4",children:n.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-100 text-blue-600 rounded-full text-sm font-semibold",children:s+1}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.city}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[(0,t.jsxs)("span",{children:[e.propertyReviews," недвижимости"]}),(0,t.jsx)("span",{children:"•"}),(0,t.jsxs)("span",{children:[e.tenantReviews," жильцов"]})]})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"font-semibold",children:e.totalReviews}),(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:["★ ",e.averageRating]}),e.growth>0&&(0,t.jsxs)(r.E,{variant:"secondary",className:"text-xs bg-green-100 text-green-700",children:["+",e.growth,"%"]})]})]})]},e.city))})})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{children:[(0,t.jsxs)(j.ZB,{className:"flex items-center",children:[(0,t.jsx)(g.A,{className:"h-5 w-5 mr-2"}),"Тренды роста по городам"]}),(0,t.jsx)(j.BT,{children:"Города с самым быстрым ростом активности по отзывам"})]}),(0,t.jsx)(j.Wu,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[n.filter(e=>e.growth>0).sort((e,s)=>s.growth-e.growth).slice(0,8).map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"flex items-center justify-center w-8 h-8 bg-green-100 text-green-600 rounded-full text-sm font-semibold",children:s+1}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.city}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[e.totalReviews," всего отзывов"]})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)(r.E,{className:"bg-green-100 text-green-700",children:["+",e.growth,"%"]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["★ ",e.averageRating]})]})]},e.city)),0===n.filter(e=>e.growth>0).length&&(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(g.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{children:"Нет данных о росте"})]})]})})]})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{children:[(0,t.jsxs)(j.ZB,{className:"flex items-center",children:[(0,t.jsx)(b.A,{className:"h-5 w-5 mr-2"}),"Распределение отзывов"]}),(0,t.jsx)(j.BT,{children:"Отзывы о недвижимости и жильцах по топ городам"})]}),(0,t.jsx)(j.Wu,{children:(0,t.jsx)("div",{className:"space-y-4",children:n.slice(0,8).map(e=>{let s=e.totalReviews>0?Math.round(e.propertyReviews/e.totalReviews*100):0,a=100-s;return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"font-medium",children:e.city}),(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:[e.totalReviews," отзывов"]})]}),(0,t.jsxs)("div",{className:"flex h-2 bg-gray-200 rounded-full overflow-hidden",children:[(0,t.jsx)("div",{className:"bg-blue-500 transition-all duration-300",style:{width:"".concat(s,"%")},title:"".concat(e.propertyReviews," отзывов о недвижимости (").concat(s,"%)")}),(0,t.jsx)("div",{className:"bg-purple-500 transition-all duration-300",style:{width:"".concat(a,"%")},title:"".concat(e.tenantReviews," отзывов о жильцах (").concat(a,"%)")})]}),(0,t.jsxs)("div",{className:"flex justify-between text-xs text-gray-600",children:[(0,t.jsxs)("span",{children:["Недвижимость: ",e.propertyReviews," (",s,"%)"]}),(0,t.jsxs)("span",{children:["Жильцы: ",e.tenantReviews," (",a,"%)"]})]})]},e.city)})})})]})]})}var A=a(6583),Z=a(814);function B(){var e,s;let{data:a,isLoading:l}=(0,h.useQuery)("user-growth",async()=>(await u.FH.get("/admin/user-growth")).data);if(l)return(0,t.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{className:"animate-pulse",children:[(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/2"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]}),(0,t.jsx)(j.Wu,{children:(0,t.jsx)("div",{className:"h-64 bg-gray-200 rounded animate-pulse"})})]})});let i=(null==a?void 0:a.monthlyGrowth)||[];if(0===i.length)return(0,t.jsxs)(j.Zp,{children:[(0,t.jsx)(j.aR,{children:(0,t.jsxs)(j.ZB,{className:"flex items-center",children:[(0,t.jsx)(g.A,{className:"h-5 w-5 mr-2"}),"Рост пользователей"]})}),(0,t.jsx)(j.Wu,{children:(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(d.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{children:"Нет данных о росте"})]})})]});let n=i[i.length-1],c=i[i.length-2],x=c&&c.newUsers>0?Math.round((n.newUsers-c.newUsers)/c.newUsers*100):0,m=Math.max(...i.map(e=>e.totalUsers)),o=Math.max(...i.map(e=>e.newUsers));return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(j.ZB,{className:"text-sm font-medium",children:"Всего пользователей"}),(0,t.jsx)(d.A,{className:"h-4 w-4 text-blue-600"})]}),(0,t.jsxs)(j.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:(null==n||null==(e=n.totalUsers)?void 0:e.toLocaleString())||0}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+",(null==n?void 0:n.newUsers)||0," за этот месяц"]})]})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(j.ZB,{className:"text-sm font-medium",children:"Месячный рост"}),(0,t.jsx)(g.A,{className:"h-4 w-4 text-green-600"})]}),(0,t.jsxs)(j.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:(null==n?void 0:n.newUsers)||0}),(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsxs)(r.E,{variant:x>=0?"default":"destructive",className:"text-xs",children:[x>=0?"+":"",x,"%"]})})]})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(j.ZB,{className:"text-sm font-medium",children:"Активные пользователи"}),(0,t.jsx)(A.A,{className:"h-4 w-4 text-purple-600"})]}),(0,t.jsxs)(j.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:(null==n||null==(s=n.activeUsers)?void 0:s.toLocaleString())||0}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(null==n?void 0:n.totalUsers)>0?Math.round((null==n?void 0:n.activeUsers)/(null==n?void 0:n.totalUsers)*100):0,"% от общего числа"]})]})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(j.ZB,{className:"text-sm font-medium",children:"Коэффициент удержания"}),(0,t.jsx)(Z.A,{className:"h-4 w-4 text-orange-600"})]}),(0,t.jsxs)(j.Wu,{children:[(0,t.jsxs)("div",{className:"text-2xl font-bold",children:[(null==n?void 0:n.retentionRate)||0,"%"]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Месячное удержание"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{children:[(0,t.jsxs)(j.ZB,{className:"flex items-center",children:[(0,t.jsx)(g.A,{className:"h-5 w-5 mr-2"}),"Динамика роста пользователей"]}),(0,t.jsx)(j.BT,{children:"Общее количество пользователей и новых регистраций по месяцам"})]}),(0,t.jsx)(j.Wu,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex gap-6 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded mr-2"}),(0,t.jsx)("span",{children:"Всего пользователей"})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded mr-2"}),(0,t.jsx)("span",{children:"Новые пользователи"})]})]}),(0,t.jsx)("div",{className:"h-64 flex items-end justify-between space-x-1 bg-gray-50 p-4 rounded-lg",children:i.map((e,s)=>(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-1 min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"flex items-end space-x-0.5 h-48",children:[(0,t.jsx)("div",{className:"bg-blue-500 rounded-t w-1 transition-all duration-300 hover:bg-blue-600",style:{height:m>0?"".concat(e.totalUsers/m*100,"%"):"0%"},title:"".concat(e.totalUsers," всего пользователей")}),(0,t.jsx)("div",{className:"bg-green-500 rounded-t w-3 transition-all duration-300 hover:bg-green-600",style:{height:o>0?"".concat(e.newUsers/o*100,"%"):"0%"},title:"".concat(e.newUsers," новых пользователей")})]}),(0,t.jsx)("div",{className:"text-xs text-gray-500 transform -rotate-45 origin-top-left whitespace-nowrap",children:e.month})]},e.month))})]})})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{children:[(0,t.jsxs)(j.ZB,{className:"flex items-center",children:[(0,t.jsx)(d.A,{className:"h-5 w-5 mr-2"}),"Метрики вовлеченности пользователей"]}),(0,t.jsx)(j.BT,{children:"Активные пользователи и коэффициенты удержания"})]}),(0,t.jsx)(j.Wu,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium mb-3",children:"Активные пользователи по месяцам"}),(0,t.jsx)("div",{className:"space-y-2",children:i.slice(-6).map(e=>{let s=e.totalUsers>0?Math.round(e.activeUsers/e.totalUsers*100):0;return(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600 w-16",children:e.month}),(0,t.jsx)("div",{className:"flex-1 mx-3",children:(0,t.jsx)("div",{className:"bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-purple-500 h-2 rounded-full transition-all duration-300",style:{width:"".concat(s,"%")}})})}),(0,t.jsx)("span",{className:"text-sm font-medium w-16 text-right",children:e.activeUsers.toLocaleString()})]},e.month)})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium mb-3",children:"Месячный коэффициент удержания"}),(0,t.jsx)("div",{className:"space-y-2",children:i.slice(-6).map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600 w-16",children:e.month}),(0,t.jsx)("div",{className:"flex-1 mx-3",children:(0,t.jsx)("div",{className:"bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-orange-500 h-2 rounded-full transition-all duration-300",style:{width:"".concat(e.retentionRate,"%")}})})}),(0,t.jsxs)("span",{className:"text-sm font-medium w-16 text-right",children:[e.retentionRate,"%"]})]},e.month))})]})]})})]})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{children:[(0,t.jsxs)(j.ZB,{className:"flex items-center",children:[(0,t.jsx)(N.A,{className:"h-5 w-5 mr-2"}),"Инсайты по росту"]}),(0,t.jsx)(j.BT,{children:"Ключевые метрики и анализ трендов"})]}),(0,t.jsx)(j.Wu,{children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-blue-900",children:"Лучший месяц по росту"}),(0,t.jsx)("p",{className:"text-xs text-blue-700",children:i.length>0?i.reduce((e,s)=>s.newUsers>e.newUsers?s:e).month:"Н/Д"})]}),(0,t.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:["+",i.length>0?Math.max(...i.map(e=>e.newUsers)):0]})]})}),(0,t.jsx)("div",{className:"bg-green-50 p-4 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-green-900",children:"Средний месячный рост"}),(0,t.jsx)("p",{className:"text-xs text-green-700",children:"Последние 6 месяцев"})]}),(0,t.jsx)("div",{className:"text-2xl font-bold text-green-600",children:i.length>=6?Math.round(i.slice(-6).reduce((e,s)=>e+s.newUsers,0)/6):0})]})}),(0,t.jsx)("div",{className:"bg-purple-50 p-4 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-purple-900",children:"Самое высокое удержание"}),(0,t.jsx)("p",{className:"text-xs text-purple-700",children:i.length>0?i.reduce((e,s)=>s.retentionRate>e.retentionRate?s:e).month:"Н/Д"})]}),(0,t.jsxs)("div",{className:"text-2xl font-bold text-purple-600",children:[i.length>0?Math.max(...i.map(e=>e.retentionRate)):0,"%"]})]})}),(0,t.jsx)("div",{className:"bg-orange-50 p-4 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-orange-900",children:"Темп роста"}),(0,t.jsx)("p",{className:"text-xs text-orange-700",children:"Месяц к месяцу"})]}),(0,t.jsxs)("div",{className:"text-2xl font-bold text-orange-600",children:[x>=0?"+":"",x,"%"]})]})})]})})]})]})}function _(){var e,s,a,l,r,m,o,f,y,b,A,Z,_,C,W,U,k,F,L,S,P;let{data:E,isLoading:M}=(0,h.useQuery)("admin-stats",async()=>(await u.FH.get("/admin/stats")).data);if(M)return(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(8)].map((e,s)=>(0,t.jsx)(j.Zp,{children:(0,t.jsxs)(j.aR,{className:"animate-pulse",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]})},s))})});let H=[{title:"Всего пользователей",value:(null==E||null==(e=E.users)?void 0:e.total)||0,description:"+".concat((null==E||null==(s=E.users)?void 0:s.daily)||0," сегодня"),icon:d.A,color:"text-blue-600",change:(null==E||null==(a=E.users)?void 0:a.weeklyGrowth)||0},{title:"Отзывы о недвижимости",value:(null==E||null==(l=E.propertyReviews)?void 0:l.total)||0,description:"+".concat((null==E||null==(r=E.propertyReviews)?void 0:r.daily)||0," сегодня"),icon:p.A,color:"text-green-600",change:(null==E||null==(m=E.propertyReviews)?void 0:m.weeklyGrowth)||0},{title:"Отзывы о жильцах",value:(null==E||null==(o=E.tenantReviews)?void 0:o.total)||0,description:"+".concat((null==E||null==(f=E.tenantReviews)?void 0:f.daily)||0," сегодня"),icon:v.A,color:"text-purple-600",change:(null==E||null==(y=E.tenantReviews)?void 0:y.weeklyGrowth)||0},{title:"Ожидают модерации",value:((null==E||null==(b=E.propertyReviews)?void 0:b.pending)||0)+((null==E||null==(A=E.tenantReviews)?void 0:A.pending)||0),description:"Ожидают модерации",icon:c.A,color:"text-yellow-600",change:0}];return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6",children:H.map((e,s)=>{let a=e.icon;return(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(j.ZB,{className:"text-sm font-medium",children:e.title}),(0,t.jsx)(a,{className:"h-4 w-4 ".concat(e.color)})]}),(0,t.jsxs)(j.Wu,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:e.value.toLocaleString()}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:e.description}),0!==e.change&&(0,t.jsxs)("div",{className:"flex items-center text-xs ".concat(e.change>0?"text-green-600":"text-red-600"),children:[(0,t.jsx)(g.A,{className:"h-3 w-3 mr-1 ".concat(e.change<0?"rotate-180":"")}),Math.abs(e.change),"%"]})]})]})]},s)})}),(0,t.jsxs)(i.tU,{defaultValue:"overview",className:"space-y-4",children:[(0,t.jsxs)(i.j7,{className:"grid w-full grid-cols-2 lg:grid-cols-4",children:[(0,t.jsx)(i.Xi,{value:"overview",children:"Обзор"}),(0,t.jsx)(i.Xi,{value:"activity",children:"Активность"}),(0,t.jsx)(i.Xi,{value:"geography",children:"География"}),(0,t.jsx)(i.Xi,{value:"growth",children:"Рост"})]}),(0,t.jsxs)(i.av,{value:"overview",className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,t.jsxs)(j.Zp,{children:[(0,t.jsx)(j.aR,{children:(0,t.jsxs)(j.ZB,{className:"flex items-center text-lg",children:[(0,t.jsx)(N.A,{className:"h-5 w-5 mr-2 text-blue-600"}),"Статистика за неделю"]})}),(0,t.jsxs)(j.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Новых пользователей"}),(0,t.jsx)("span",{className:"font-semibold",children:(null==E||null==(Z=E.users)?void 0:Z.weekly)||0})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Отзывов о недвижимости"}),(0,t.jsx)("span",{className:"font-semibold",children:(null==E||null==(_=E.propertyReviews)?void 0:_.weekly)||0})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Отзывов о жильцах"}),(0,t.jsx)("span",{className:"font-semibold",children:(null==E||null==(C=E.tenantReviews)?void 0:C.weekly)||0})]})]})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsx)(j.aR,{children:(0,t.jsxs)(j.ZB,{className:"flex items-center text-lg",children:[(0,t.jsx)(N.A,{className:"h-5 w-5 mr-2 text-green-600"}),"Статистика за месяц"]})}),(0,t.jsxs)(j.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Новых пользователей"}),(0,t.jsx)("span",{className:"font-semibold",children:(null==E||null==(W=E.users)?void 0:W.monthly)||0})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Отзывов о недвижимости"}),(0,t.jsx)("span",{className:"font-semibold",children:(null==E||null==(U=E.propertyReviews)?void 0:U.monthly)||0})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Отзывов о жильцах"}),(0,t.jsx)("span",{className:"font-semibold",children:(null==E||null==(k=E.tenantReviews)?void 0:k.monthly)||0})]})]})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsx)(j.aR,{children:(0,t.jsxs)(j.ZB,{className:"flex items-center text-lg",children:[(0,t.jsx)(x.A,{className:"h-5 w-5 mr-2 text-red-600"}),"Очередь на модерацию"]})}),(0,t.jsxs)(j.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Недвижимость в ожидании"}),(0,t.jsx)("span",{className:"font-semibold",children:(null==E||null==(F=E.propertyReviews)?void 0:F.pending)||0})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Жильцы в ожидании"}),(0,t.jsx)("span",{className:"font-semibold",children:(null==E||null==(L=E.tenantReviews)?void 0:L.pending)||0})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Жалобы на контент"}),(0,t.jsx)("span",{className:"font-semibold text-red-600",children:((null==E||null==(S=E.propertyReviews)?void 0:S.reported)||0)+((null==E||null==(P=E.tenantReviews)?void 0:P.reported)||0)})]})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(j.Zp,{children:[(0,t.jsx)(j.aR,{children:(0,t.jsxs)(j.ZB,{className:"flex items-center",children:[(0,t.jsx)(n.A,{className:"h-5 w-5 mr-2"}),"Оценки отзывов о недвижимости"]})}),(0,t.jsx)(j.Wu,{children:(0,t.jsx)("div",{className:"space-y-3",children:[5,4,3,2,1].map(e=>{var s,a,l;let r=(null==E||null==(a=E.propertyReviews)||null==(s=a.ratingDistribution)?void 0:s[e])||0,i=Math.round(r/((null==E||null==(l=E.propertyReviews)?void 0:l.total)||1)*100);return(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)("span",{className:"text-sm font-medium w-8",children:[e,"★"]}),(0,t.jsx)("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-yellow-500 h-2 rounded-full transition-all duration-300",style:{width:"".concat(i,"%")}})}),(0,t.jsx)("span",{className:"text-sm text-gray-600 w-12",children:r}),(0,t.jsxs)("span",{className:"text-sm text-gray-500 w-10",children:[i,"%"]})]},e)})})})]}),(0,t.jsxs)(j.Zp,{children:[(0,t.jsx)(j.aR,{children:(0,t.jsxs)(j.ZB,{className:"flex items-center",children:[(0,t.jsx)(n.A,{className:"h-5 w-5 mr-2"}),"Оценки отзывов о жильцах"]})}),(0,t.jsx)(j.Wu,{children:(0,t.jsx)("div",{className:"space-y-3",children:[5,4,3,2,1].map(e=>{var s,a,l;let r=(null==E||null==(a=E.tenantReviews)||null==(s=a.ratingDistribution)?void 0:s[e])||0,i=Math.round(r/((null==E||null==(l=E.tenantReviews)?void 0:l.total)||1)*100);return(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)("span",{className:"text-sm font-medium w-8",children:[e,"★"]}),(0,t.jsx)("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-yellow-500 h-2 rounded-full transition-all duration-300",style:{width:"".concat(i,"%")}})}),(0,t.jsx)("span",{className:"text-sm text-gray-600 w-12",children:r}),(0,t.jsxs)("span",{className:"text-sm text-gray-500 w-10",children:[i,"%"]})]},e)})})})]})]})]}),(0,t.jsx)(i.av,{value:"activity",children:(0,t.jsx)(w,{})}),(0,t.jsx)(i.av,{value:"geography",children:(0,t.jsx)(R,{})}),(0,t.jsx)(i.av,{value:"growth",children:(0,t.jsx)(B,{})})]})]})}var C=a(2115),W=a(7003),U=a(5917),k=a(5229),F=a(2663);function L(){let e=(0,h.useQueryClient)(),[s,a]=(0,C.useState)({}),{data:l,isLoading:n}=(0,h.useQuery)("pending-reviews",async()=>(await u.FH.get("/admin/pending-reviews")).data),d=(0,h.useMutation)(async e=>{let{id:s,action:a}=e;await u.FH.patch("/admin/property-reviews/".concat(s,"/moderate"),{action:a})},{onSuccess:()=>{e.invalidateQueries("pending-reviews"),e.invalidateQueries("admin-stats"),F.Ay.success("Отзыв успешно модерирован")},onError:()=>{F.Ay.error("Не удалось модерировать отзыв")}}),x=(0,h.useMutation)(async e=>{let{id:s,action:a}=e;await u.FH.patch("/admin/tenant-reviews/".concat(s,"/moderate"),{action:a})},{onSuccess:()=>{e.invalidateQueries("pending-reviews"),e.invalidateQueries("admin-stats"),F.Ay.success("Отзыв успешно модерирован")},onError:()=>{F.Ay.error("Не удалось модерировать отзыв")}}),m=async(e,s,t)=>{a(a=>({...a,["".concat(e,"-").concat(s)]:!0}));try{"property"===t?await d.mutateAsync({id:e,action:s}):await x.mutateAsync({id:e,action:s})}finally{a(a=>({...a,["".concat(e,"-").concat(s)]:!1}))}};if(n)return(0,t.jsxs)(j.Zp,{children:[(0,t.jsx)(j.aR,{children:(0,t.jsx)(j.ZB,{children:"Загрузка ожидающих отзывов..."})}),(0,t.jsx)(j.Wu,{children:(0,t.jsx)("div",{className:"animate-pulse space-y-4",children:[void 0,void 0,void 0].map((e,s)=>(0,t.jsx)("div",{className:"h-24 bg-gray-200 rounded"},s))})})]});let o=(null==l?void 0:l.propertyReviews)||[],g=(null==l?void 0:l.tenantReviews)||[],f=o.length+g.length;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(j.Zp,{children:(0,t.jsxs)(j.aR,{children:[(0,t.jsxs)(j.ZB,{className:"flex items-center",children:[(0,t.jsx)(c.A,{className:"h-5 w-5 mr-2"}),"Ожидающие отзывы (",f,")"]}),(0,t.jsx)(j.BT,{children:"Отзывы, ожидающие одобрения модерации"})]})}),0===f?(0,t.jsx)(j.Zp,{children:(0,t.jsxs)(j.Wu,{className:"text-center py-8",children:[(0,t.jsx)(c.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Нет ожидающих отзывов"})]})}):(0,t.jsxs)(i.tU,{defaultValue:"property",className:"space-y-4",children:[(0,t.jsxs)(i.j7,{className:"grid w-full grid-cols-2",children:[(0,t.jsxs)(i.Xi,{value:"property",className:"flex items-center gap-2",children:[(0,t.jsx)(p.A,{className:"h-4 w-4"}),"Недвижимость (",o.length,")"]}),(0,t.jsxs)(i.Xi,{value:"tenant",className:"flex items-center gap-2",children:[(0,t.jsx)(v.A,{className:"h-4 w-4"}),"Арендатор (",g.length,")"]})]}),(0,t.jsx)(i.av,{value:"property",className:"space-y-4",children:0===o.length?(0,t.jsx)(j.Zp,{children:(0,t.jsx)(j.Wu,{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-gray-500",children:"Нет ожидающих отзывов о недвижимости"})})}):o.map(e=>(console.log(e),(0,t.jsxs)(j.Zp,{children:[(0,t.jsx)(j.aR,{children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(j.ZB,{className:"flex items-center text-lg",children:[(0,t.jsx)(p.A,{className:"h-5 w-5 mr-2 text-blue-600"}),e.street," ",e.building,", ",e.city]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsxs)(r.E,{variant:"secondary",children:[e.numberOfRooms," комн."]}),(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:["от ",e.author.firstName," ",e.author.lastName]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(W.$,{size:"sm",onClick:()=>m(e._id,"approve","property"),disabled:s["".concat(e._id,"-approve")],className:"bg-green-600 hover:bg-green-700",children:[(0,t.jsx)(U.A,{className:"h-4 w-4 mr-1"}),s["".concat(e._id,"-approve")]?"...":"Одобрить"]}),(0,t.jsxs)(W.$,{size:"sm",variant:"destructive",onClick:()=>m(e._id,"reject","property"),disabled:s["".concat(e._id,"-reject")],children:[(0,t.jsx)(k.A,{className:"h-4 w-4 mr-1"}),s["".concat(e._id,"-reject")]?"...":"Отклонить"]})]})]})}),(0,t.jsx)(j.Wu,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,t.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Аренда: ",e.rentalPeriod.from.month,"/",e.rentalPeriod.from.year," -"," ",e.rentalPeriod.to.month,"/",e.rentalPeriod.to.year]}),(0,t.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:["Номер квартиры: ",e.building]}),(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Арендодатель:"})," ",e.landlordName]}),(0,t.jsx)("p",{className:"text-gray-700",children:e.reviewText}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:["Отправлено:"," ",new Date(e.createdAt).toLocaleString("ru-RU")]})]})})]},e._id)))}),(0,t.jsx)(i.av,{value:"tenant",className:"space-y-4",children:0===g.length?(0,t.jsx)(j.Zp,{children:(0,t.jsx)(j.Wu,{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-gray-500",children:"Нет ожидающих отзывов об арендаторах"})})}):g.map(e=>(0,t.jsxs)(j.Zp,{children:[(0,t.jsx)(j.aR,{children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(j.ZB,{className:"flex items-center text-lg",children:[(0,t.jsx)(v.A,{className:"h-5 w-5 mr-2 text-green-600"}),e.tenantFullName]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsxs)(r.E,{variant:"secondary",children:["ИНН: ***",e.tenantIdLastFour]}),(0,t.jsxs)(r.E,{variant:"secondary",children:["Телефон: ***",e.tenantPhoneLastFour]}),(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:["от ",e.author.firstName," ",e.author.lastName]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(W.$,{size:"sm",onClick:()=>m(e._id,"approve","tenant"),disabled:s["".concat(e._id,"-approve")],className:"bg-green-600 hover:bg-green-700",children:[(0,t.jsx)(U.A,{className:"h-4 w-4 mr-1"}),s["".concat(e._id,"-approve")]?"...":"Одобрить"]}),(0,t.jsxs)(W.$,{size:"sm",variant:"destructive",onClick:()=>m(e._id,"reject","tenant"),disabled:s["".concat(e._id,"-reject")],children:[(0,t.jsx)(k.A,{className:"h-4 w-4 mr-1"}),s["".concat(e._id,"-reject")]?"...":"Отклонить"]})]})]})}),(0,t.jsx)(j.Wu,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,t.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Аренда: ",e.rentalPeriod.from.month,"/",e.rentalPeriod.from.year," -"," ",e.rentalPeriod.to.month,"/",e.rentalPeriod.to.year]}),(0,t.jsx)("p",{className:"text-gray-700 break-words whitespace-pre-line",children:e.reviewText}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:["Отправлено:"," ",new Date(e.createdAt).toLocaleString("ru-RU")]})]})})]},e._id))})]})]})}var S=a(6170),P=a(6651),E=a(3664),M=a(2181),H=a(501);function z(){let e=(0,h.useQueryClient)(),[s,a]=(0,C.useState)(""),[l,i]=(0,C.useState)({}),{data:n,isLoading:c}=(0,h.useQuery)("admin-users",async()=>(await u.FH.get("/admin/users")).data),x=(0,h.useMutation)(async e=>{let{userId:s,isActive:a}=e;await u.FH.patch("/admin/users/".concat(s,"/status"),{isActive:a})},{onSuccess:()=>{e.invalidateQueries("admin-users"),F.Ay.success("Статус пользователя успешно обновлён")},onError:()=>{F.Ay.error("Не удалось обновить статус пользователя")}}),m=async(e,s)=>{i(s=>({...s,[e]:!0}));try{await x.mutateAsync({userId:e,isActive:!s})}finally{i(s=>({...s,[e]:!1}))}},o=(null==n?void 0:n.filter(e=>e.firstName.toLowerCase().includes(s.toLowerCase())||e.lastName.toLowerCase().includes(s.toLowerCase())||e.email.toLowerCase().includes(s.toLowerCase())))||[];return c?(0,t.jsxs)(j.Zp,{children:[(0,t.jsx)(j.aR,{children:(0,t.jsx)(j.ZB,{children:"Загрузка пользователей..."})}),(0,t.jsx)(j.Wu,{children:(0,t.jsx)("div",{className:"animate-pulse space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,t.jsx)("div",{className:"h-16 bg-gray-200 rounded"},s))})})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{children:[(0,t.jsxs)(j.ZB,{className:"flex items-center",children:[(0,t.jsx)(d.A,{className:"h-5 w-5 mr-2"}),"Управление пользователями (",(null==n?void 0:n.length)||0,")"]}),(0,t.jsx)(j.BT,{children:"Управляйте аккаунтами пользователей и их правами"})]}),(0,t.jsx)(j.Wu,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(P.A,{className:"h-4 w-4 text-gray-400"}),(0,t.jsx)(S.p,{placeholder:"Поиск пользователей по имени или email...",value:s,onChange:e=>a(e.target.value),className:"max-w-sm"})]})})]}),(0,t.jsx)("div",{className:"grid gap-4",children:0===o.length?(0,t.jsx)(j.Zp,{children:(0,t.jsxs)(j.Wu,{className:"text-center py-8",children:[(0,t.jsx)(d.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{className:"text-gray-500",children:s?"Пользователи, соответствующие вашему запросу, не найдены":"Пользователи не найдены"})]})}):o.map(e=>(0,t.jsx)(j.Zp,{children:(0,t.jsx)(j.Wu,{className:"p-6",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("h3",{className:"font-semibold text-lg",children:[e.firstName," ",e.lastName]}),(0,t.jsx)(r.E,{variant:e.isActive?"default":"secondary",children:e.isActive?"Активен":"Неактивен"}),(0,t.jsx)(r.E,{variant:"outline",children:e.role})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 text-sm text-gray-600",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(E.A,{className:"h-4 w-4 mr-1"}),e.email]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(N.A,{className:"h-4 w-4 mr-1"}),"Зарегистрирован"," ",new Date(e.createdAt).toLocaleDateString()]}),e.lastLogin&&(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(M.A,{className:"h-4 w-4 mr-1"}),"Последний вход"," ",new Date(e.lastLogin).toLocaleDateString()]})]})]}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsx)(W.$,{size:"sm",variant:e.isActive?"destructive":"default",onClick:()=>m(e._id,e.isActive),disabled:l[e._id],children:e.isActive?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(H.A,{className:"h-4 w-4 mr-1"}),l[e._id]?"...":"Деактивировать"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(M.A,{className:"h-4 w-4 mr-1"}),l[e._id]?"...":"Активировать"]})})})]})})},e._id))})]})}var Q=a(7828);function T(){let e=(0,h.useQueryClient)(),[s,a]=(0,C.useState)({}),{data:l,isLoading:n}=(0,h.useQuery)("reported-content",async()=>(await u.FH.get("/admin/reported-content")).data),c=(0,h.useMutation)(async e=>{let{type:s,id:a,action:t}=e;await u.FH.patch("/admin/reported-content/".concat(s,"/").concat(a),{action:t})},{onSuccess:()=>{e.invalidateQueries("reported-content"),e.invalidateQueries("admin-stats"),F.Ay.success("Контент успешно обработан")},onError:()=>{F.Ay.error("Не удалось обработать жалобу на контент")}}),d=async(e,s,t)=>{a(e=>({...e,["".concat(s,"-").concat(t)]:!0}));try{await c.mutateAsync({type:e,id:s,action:t})}finally{a(e=>({...e,["".concat(s,"-").concat(t)]:!1}))}};if(n)return(0,t.jsxs)(j.Zp,{children:[(0,t.jsx)(j.aR,{children:(0,t.jsx)(j.ZB,{children:"Загрузка жалоб..."})}),(0,t.jsx)(j.Wu,{children:(0,t.jsx)("div",{className:"animate-pulse space-y-4",children:[void 0,void 0,void 0].map((e,s)=>(0,t.jsx)("div",{className:"h-24 bg-gray-200 rounded"},s))})})]});let m=(null==l?void 0:l.propertyReviews)||[],o=(null==l?void 0:l.tenantReviews)||[],g=m.length+o.length;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(j.Zp,{children:(0,t.jsxs)(j.aR,{children:[(0,t.jsxs)(j.ZB,{className:"flex items-center",children:[(0,t.jsx)(x.A,{className:"h-5 w-5 mr-2 text-red-600"}),"Жалобы на контент (",g,")"]}),(0,t.jsx)(j.BT,{children:"Отзывы и комментарии, на которые пожаловались пользователи"})]})}),0===g?(0,t.jsx)(j.Zp,{children:(0,t.jsxs)(j.Wu,{className:"text-center py-8",children:[(0,t.jsx)(x.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,t.jsx)("p",{className:"text-gray-500",children:"На данный момент жалоб нет"})]})}):(0,t.jsxs)(i.tU,{defaultValue:"property",className:"space-y-4",children:[(0,t.jsxs)(i.j7,{className:"grid w-full grid-cols-2",children:[(0,t.jsxs)(i.Xi,{value:"property",className:"flex items-center gap-2",children:[(0,t.jsx)(p.A,{className:"h-4 w-4"}),"Недвижимость (",m.length,")"]}),(0,t.jsxs)(i.Xi,{value:"tenant",className:"flex items-center gap-2",children:[(0,t.jsx)(v.A,{className:"h-4 w-4"}),"Арендатор (",o.length,")"]})]}),(0,t.jsx)(i.av,{value:"property",className:"space-y-4",children:0===m.length?(0,t.jsx)(j.Zp,{children:(0,t.jsx)(j.Wu,{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-gray-500",children:"Нет жалоб на отзывы о недвижимости"})})}):m.map(e=>(0,t.jsxs)(j.Zp,{className:"border-red-200",children:[(0,t.jsx)(j.aR,{children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(j.ZB,{className:"flex items-center text-lg",children:[(0,t.jsx)(p.A,{className:"h-5 w-5 mr-2 text-blue-600"}),e.street," ",e.building,", ",e.city]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsxs)(r.E,{variant:"destructive",children:[e.reportCount," жалоб",e.reportCount>1?"ы":"а"]}),(0,t.jsxs)(r.E,{variant:"secondary",children:[e.numberOfRooms," комнат"]}),(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:["от ",e.author.firstName," ",e.author.lastName]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(W.$,{size:"sm",variant:"outline",onClick:()=>d("property",e._id,"dismiss"),disabled:s["".concat(e._id,"-dismiss")],children:[(0,t.jsx)(Q.A,{className:"h-4 w-4 mr-1"}),s["".concat(e._id,"-dismiss")]?"...":"Снять жалобу"]}),(0,t.jsxs)(W.$,{size:"sm",onClick:()=>d("property",e._id,"approve"),disabled:s["".concat(e._id,"-approve")],className:"bg-green-600 hover:bg-green-700",children:[(0,t.jsx)(U.A,{className:"h-4 w-4 mr-1"}),s["".concat(e._id,"-approve")]?"...":"Одобрить"]}),(0,t.jsxs)(W.$,{size:"sm",variant:"destructive",onClick:()=>d("property",e._id,"delete"),disabled:s["".concat(e._id,"-delete")],children:[(0,t.jsx)(k.A,{className:"h-4 w-4 mr-1"}),s["".concat(e._id,"-delete")]?"...":"Удалить"]})]})]})}),(0,t.jsx)(j.Wu,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,t.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Аренда: ",e.rentalPeriod.from.month,"/",e.rentalPeriod.from.year," -"," ",e.rentalPeriod.to.month,"/",e.rentalPeriod.to.year]}),(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Арендодатель:"})," ",e.landlordName]}),(0,t.jsx)("p",{className:"text-gray-700",children:e.reviewText}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:["Добавлено:"," ",new Date(e.createdAt).toLocaleString("ru-RU")]})]})})]},e._id))}),(0,t.jsx)(i.av,{value:"tenant",className:"space-y-4",children:0===o.length?(0,t.jsx)(j.Zp,{children:(0,t.jsx)(j.Wu,{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-gray-500",children:"Нет жалоб на отзывы об арендаторах"})})}):o.map(e=>(0,t.jsxs)(j.Zp,{className:"border-red-200",children:[(0,t.jsx)(j.aR,{children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(j.ZB,{className:"flex items-center text-lg",children:[(0,t.jsx)(v.A,{className:"h-5 w-5 mr-2 text-green-600"}),e.tenantFullName]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsxs)(r.E,{variant:"destructive",children:[e.reportCount," жалоб",e.reportCount>1?"ы":"а"]}),(0,t.jsxs)(r.E,{variant:"secondary",children:["ИНН: ***",e.tenantIdLastFour]}),(0,t.jsxs)(r.E,{variant:"secondary",children:["Тел: ***",e.tenantPhoneLastFour]}),(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:["от ",e.author.firstName," ",e.author.lastName]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(W.$,{size:"sm",variant:"outline",onClick:()=>d("tenant",e._id,"dismiss"),disabled:s["".concat(e._id,"-dismiss")],children:[(0,t.jsx)(Q.A,{className:"h-4 w-4 mr-1"}),s["".concat(e._id,"-dismiss")]?"...":"Снять жалобу"]}),(0,t.jsxs)(W.$,{size:"sm",onClick:()=>d("tenant",e._id,"approve"),disabled:s["".concat(e._id,"-approve")],className:"bg-green-600 hover:bg-green-700",children:[(0,t.jsx)(U.A,{className:"h-4 w-4 mr-1"}),s["".concat(e._id,"-approve")]?"...":"Одобрить"]}),(0,t.jsxs)(W.$,{size:"sm",variant:"destructive",onClick:()=>d("tenant",e._id,"delete"),disabled:s["".concat(e._id,"-delete")],children:[(0,t.jsx)(k.A,{className:"h-4 w-4 mr-1"}),s["".concat(e._id,"-delete")]?"...":"Удалить"]})]})]})}),(0,t.jsx)(j.Wu,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,t.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Аренда: ",e.rentalPeriod.from.month,"/",e.rentalPeriod.from.year," -"," ",e.rentalPeriod.to.month,"/",e.rentalPeriod.to.year]}),(0,t.jsx)("p",{className:"text-gray-700",children:e.reviewText}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:["Добавлено:"," ",new Date(e.createdAt).toLocaleString("ru-RU")]})]})})]},e._id))})]})]})}function D(){let e=(0,h.useQueryClient)(),[s,a]=(0,C.useState)("pending"),{data:l,isLoading:r}=(0,h.useQuery)("admin-comments",async()=>(await u.FH.get("/admin/comments")).data),n=(0,h.useMutation)(async e=>{let{type:s,reviewId:a,commentId:t,action:l}=e;await u.FH.patch("/admin/".concat(s,"-reviews/").concat(a,"/comments/").concat(t,"/moderate"),{action:l})},{onSuccess:()=>{e.invalidateQueries("admin-comments"),F.Ay.success("Комментарий успешно модерирован")},onError:()=>{F.Ay.error("Не удалось модерировать комментарий")}});if(r)return(0,t.jsx)("div",{className:"text-center py-8",children:"Загрузка комментариев..."});let c=(null==l?void 0:l.propertyComments)||[],d=(null==l?void 0:l.tenantComments)||[];return(0,t.jsxs)(j.Zp,{children:[(0,t.jsxs)(j.aR,{children:[(0,t.jsxs)(j.ZB,{className:"flex items-center",children:[(0,t.jsx)(m.A,{className:"h-5 w-5 mr-2"}),"Модерация комментариев"]}),(0,t.jsx)(j.BT,{children:"Проверьте, одобрите или удалите комментарии пользователей"})]}),(0,t.jsx)(j.Wu,{children:(0,t.jsxs)(i.tU,{value:s,onValueChange:a,className:"space-y-4",children:[(0,t.jsxs)(i.j7,{className:"grid w-full grid-cols-3 mb-4",children:[(0,t.jsx)(i.Xi,{value:"pending",children:"Ожидают"}),(0,t.jsx)(i.Xi,{value:"reported",children:"Жалобы"}),(0,t.jsx)(i.Xi,{value:"approved",children:"Одобренные"})]}),(0,t.jsx)(i.av,{value:s,children:(0,t.jsx)("div",{className:"space-y-4",children:["property","tenant"].map(e=>{var a;let l=(a="property"===e?c:d,"pending"===s?a.filter(e=>!e.isApproved&&!e.isReported):"reported"===s?a.filter(e=>e.isReported):"approved"===s?a.filter(e=>e.isApproved&&!e.isReported):a);return(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"font-semibold mb-2",children:["property"===e?"Недвижимость":"Арендаторы"," (",l.length,")"]}),0===l.length?(0,t.jsx)("div",{className:"text-xs text-gray-500 mb-4",children:"Нет комментариев"}):l.map(s=>{var a,l;return(0,t.jsxs)("div",{className:"border rounded p-2 bg-gray-50 flex flex-col mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-xs text-gray-600",children:[null==(a=s.author)?void 0:a.firstName," ",null==(l=s.author)?void 0:l.lastName," •"," ",new Date(s.createdAt).toLocaleString()]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[!s.isApproved&&(0,t.jsxs)(W.$,{size:"sm",onClick:()=>n.mutate({type:e,reviewId:s.reviewId,commentId:s._id,action:"approve"}),children:[(0,t.jsx)(U.A,{className:"h-4 w-4 mr-1"})," Одобрить"]}),(0,t.jsxs)(W.$,{size:"sm",variant:"destructive",onClick:()=>n.mutate({type:e,reviewId:s.reviewId,commentId:s._id,action:"delete"}),children:[(0,t.jsx)(k.A,{className:"h-4 w-4 mr-1"})," Удалить"]})]})]}),(0,t.jsx)("div",{className:"text-sm text-gray-800 mt-1",children:s.text}),s.isReported&&(0,t.jsxs)("div",{className:"text-xs text-red-600 mt-1 flex items-center",children:[(0,t.jsx)(x.A,{className:"h-3 w-3 mr-1"})," ","Жалоб: ",s.reportCount||1]})]},s._id)})]},e)})})})]})})]})}var X=a(5016);function $(){let{user:e,loading:s}=(0,l.A)(),a=(0,o.useRouter)();return s?(0,t.jsx)("div",{className:"text-center py-16",children:"Загрузка..."}):e?"admin"!==e.role&&"moderator"!==e.role?(0,t.jsxs)("div",{className:"text-center py-16",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Доступ запрещен"}),(0,t.jsx)("p",{className:"text-gray-600",children:"У вас нет прав для доступа к панели администратора."})]}):(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Панель администратора"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"Управление отзывами, пользователями и мониторинг активности платформы"})]}),(0,t.jsx)(r.E,{variant:"secondary",className:"w-fit mt-2 sm:mt-0",children:"admin"===e.role?"Администратор":"Модератор"})]}),(0,t.jsxs)(i.tU,{defaultValue:"overview",className:"space-y-6",children:[(0,t.jsxs)(i.j7,{className:"grid w-full grid-cols-2 lg:grid-cols-5",children:[(0,t.jsxs)(i.Xi,{value:"overview",className:"flex items-center gap-2",children:[(0,t.jsx)(n.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Обзор"})]}),(0,t.jsxs)(i.Xi,{value:"moderation",className:"flex items-center gap-2",children:[(0,t.jsx)(c.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Модерация"})]}),(0,t.jsxs)(i.Xi,{value:"users",className:"flex items-center gap-2",children:[(0,t.jsx)(d.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Пользователи"})]}),(0,t.jsxs)(i.Xi,{value:"reports",className:"flex items-center gap-2",children:[(0,t.jsx)(x.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Жалобы"})]}),(0,t.jsxs)(i.Xi,{value:"comments",className:"flex items-center gap-2",children:[(0,t.jsx)(m.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Комментарии"})]})]}),(0,t.jsx)(i.av,{value:"overview",children:(0,t.jsx)(_,{})}),(0,t.jsx)(i.av,{value:"moderation",children:(0,t.jsx)(L,{})}),(0,t.jsx)(i.av,{value:"users",children:(0,t.jsx)(z,{})}),(0,t.jsx)(i.av,{value:"reports",children:(0,t.jsx)(T,{})}),(0,t.jsx)(i.av,{value:"comments",children:(0,t.jsx)(D,{})})]})]}):(a.push((0,X.Y)("/login")),null)}},923:(e,s,a)=>{"use strict";a.d(s,{Xi:()=>d,av:()=>x,j7:()=>c,tU:()=>n});var t=a(5155),l=a(2115),r=a(5667),i=a(5016);let n=r.bL,c=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(r.B8,{ref:s,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...l})});c.displayName=r.B8.displayName;let d=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(r.l9,{ref:s,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...l})});d.displayName=r.l9.displayName;let x=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(r.UC,{ref:s,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...l})});x.displayName=r.UC.displayName},2734:(e,s,a)=>{"use strict";a.d(s,{A:()=>o,O:()=>m});var t=a(5155),l=a(2115),r=a(63),i=a(2378),n=a(7621),c=a(2663),d=a(5016);let x=(0,l.createContext)(void 0);function m(e){let{children:s}=e,[a,m]=(0,l.useState)(null),[o,h]=(0,l.useState)(!0),u=(0,r.useRouter)();(0,l.useEffect)(()=>{let e=i.A.get("token");e?(n.FH.defaults.headers.common.Authorization="Bearer ".concat(e),j()):h(!1)},[]);let j=async()=>{try{let e=await n.FH.get("/auth/me");m(e.data.user)}catch(e){i.A.remove("token"),delete n.FH.defaults.headers.common.Authorization,m(null)}finally{h(!1)}},p=async(e,s)=>{try{let{token:a,user:t}=(await n.FH.post("/auth/login",{email:e,password:s})).data;i.A.set("token",a,{expires:7}),n.FH.defaults.headers.common.Authorization="Bearer ".concat(a),m(t),c.Ay.success("Вход выполнен успешно!"),u.push((0,d.Y)("/dashboard"))}catch(e){var a,t;throw console.log(e),c.Ay.error((null==(t=e.response)||null==(a=t.data)?void 0:a.message)||"Ошибка входа"),e}},v=async e=>{try{let{user:s}=(await n.FH.post("/auth/register",e)).data;c.Ay.success("Код подтверждения отправлен на ваш email. Пожалуйста, введите его для завершения регистрации."),u.push("".concat((0,d.Y)("/verify-email/verify"),"?email=").concat(encodeURIComponent(s.email)))}catch(e){var s,a;throw c.Ay.error((null==(a=e.response)||null==(s=a.data)?void 0:s.message)||"Ошибка регистрации"),e}},g=async(e,s)=>{try{await n.FH.post("/auth/verify-email",{email:e,code:s}),c.Ay.success("Email успешно подтвержден!"),a?await j():u.push((0,d.Y)("/login"))}catch(e){var t,l;throw c.Ay.error((null==(l=e.response)||null==(t=l.data)?void 0:t.message)||"Ошибка подтверждения email"),e}};return(0,t.jsx)(x.Provider,{value:{user:a,isLoading:o,loading:o,login:p,register:v,verifyEmail:g,logout:()=>{i.A.remove("token"),delete n.FH.defaults.headers.common.Authorization,m(null),c.Ay.success("Вы успешно вышли из системы"),u.push("/")}},children:s})}function o(){let e=(0,l.useContext)(x);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},3022:(e,s,a)=>{Promise.resolve().then(a.bind(a,652))},3209:(e,s,a)=>{"use strict";a.d(s,{BT:()=>d,Wu:()=>x,ZB:()=>c,Zp:()=>i,aR:()=>n});var t=a(5155),l=a(2115),r=a(5016);let i=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...l})});i.displayName="Card";let n=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",a),...l})});n.displayName="CardHeader";let c=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",a),...l})});c.displayName="CardTitle";let d=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,r.cn)("text-sm text-muted-foreground",a),...l})});d.displayName="CardDescription";let x=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,r.cn)("p-6 pt-0",a),...l})});x.displayName="CardContent",l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,r.cn)("flex items-center p-6 pt-0",a),...l})}).displayName="CardFooter"},5016:(e,s,a)=>{"use strict";a.d(s,{Y:()=>i,cn:()=>r});var t=a(2821),l=a(5889);function r(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];return(0,l.QP)((0,t.$)(s))}function i(e){return e}},6170:(e,s,a)=>{"use strict";a.d(s,{p:()=>i});var t=a(5155),l=a(2115),r=a(5016);let i=l.forwardRef((e,s)=>{let{className:a,type:l,error:i,...n}=e;return(0,t.jsx)("input",{type:l,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i&&"border-red-500 focus-visible:ring-red-500",a),ref:s,...n})});i.displayName="Input"},7003:(e,s,a)=>{"use strict";a.d(s,{$:()=>d});var t=a(5155),l=a(2115),r=a(2467),i=a(3101),n=a(5016);let c=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=l.forwardRef((e,s)=>{let{className:a,variant:l,size:i,asChild:d=!1,...x}=e,m=d?r.DX:"button";return(0,t.jsx)(m,{className:(0,n.cn)(c({variant:l,size:i,className:a})),ref:s,...x})});d.displayName="Button"},7621:(e,s,a)=>{"use strict";a.d(s,{FH:()=>r,G9:()=>n,hA:()=>i});var t=a(5125),l=a(5704);let r=t.A.create({baseURL:l.env.NEXT_PUBLIC_API_URL||"https://prokvartiru.kz/api",headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>e,e=>Promise.reject(e)),r.interceptors.response.use(e=>e,e=>Promise.reject(e));let i={getRememberedAddresses:async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=new URLSearchParams;return e&&a.append("city",e),a.append("limit",s.toString()),(await r.get("/addresses/remembered?".concat(a))).data},saveRememberedAddress:async e=>(await r.post("/addresses/remembered",e)).data,getPopularAddresses:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return(await r.get("/addresses/popular?limit=".concat(e))).data},searchAddresses:async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return(await r.get("/addresses/search?q=".concat(encodeURIComponent(e),"&limit=").concat(s))).data}},n={getTrendingTopics:async()=>(await r.get("/recommendations/trending-topics")).data,getStats:async()=>(await r.get("/recommendations/stats")).data,getUserPreferences:async()=>(await r.get("/recommendations/user-preferences")).data}},7812:(e,s,a)=>{"use strict";a.d(s,{E:()=>n});var t=a(5155);a(2115);var l=a(3101),r=a(5016);let i=(0,l.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function n(e){let{className:s,variant:a,...l}=e;return(0,t.jsx)("div",{className:(0,r.cn)(i({variant:a}),s),...l})}}},e=>{e.O(0,[783,812,736,262,281,441,255,358],()=>e(e.s=3022)),_N_E=e.O()}]);